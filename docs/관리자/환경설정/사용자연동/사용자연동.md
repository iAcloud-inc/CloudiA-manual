# 사용자연동(LDAP) 사용자 가이드

CloudiA 콘솔의 **사용자연동** 메뉴는 LDAP/AD 등 외부 디렉터리와의 연동을 관리합니다. 이 문서는 실제 화면 구성을 기준으로 **목록**, **상세(매퍼 포함)**, **사용자 연동 생성·편집** 흐름을 단계별로 설명하고, 각 입력 필드의 **UI 기준 유효성 규칙**을 표로 정리합니다.

## 한눈에 보기

- **사용자연동 목록**: 연동된 LDAP 제공자의 이름/활성화/연결 URL을 확인하고, `생성`/`수정`/`삭제`/`활성화`/`비활성` 및 `더보기` 작업(전체/변경 동기화, 연동 해제, 가져온 사용자 삭제)을 수행합니다.
- **사용자연동 상세**: 연결·검색·동기화 설정 요약과 **매퍼**(속성 매핑 규칙) 탭이 제공됩니다.
- **사용자 연동 생성·편집**: `일반 옵션` → `연결 및 인증 설정` → `LDAP 검색 및 업데이트` → `동기화 설정` → `고급 설정` 순서로 입력합니다. `연결 테스트`/`인증 테스트` 후 `생성`으로 저장합니다.

---

## 사용자연동 목록

### 도구 모음과 주요 작업
- `생성`: 새 LDAP 제공자를 등록합니다.
- `수정`: 선택한 제공자의 설정을 변경합니다.
- `삭제`: 선택한 제공자를 제거합니다.
- `활성화` / `비활성`: 선택 제공자의 연동을 켜거나 끕니다.
- `더보기 ▾`
   - `모든 사용자 동기화`: LDAP 전체 사용자를 한 번에 동기화합니다.
   - `변경된 사용자 동기화`: 최근 변경분만 동기화합니다.
   - `연동 해제`: 해당 LDAP의 연결을 일시 해제합니다(Edit Mode가 ‘Unsynced’일 때만 의미가 있음).
   - `가져온 사용자 삭제`: 해당 LDAP로부터 이미 가져온 사용자 계정을 일괄 삭제합니다.

### 테이블 컬럼
| 컬럼         | 설명 |
|------------|---|
| **이름**     | LDAP 제공자 표시명입니다. |
| **활성화**    | 활성/비활성 여부를 표시합니다. |
| **연결 URL** | 연결 대상 호스트:포트 정보입니다. |

### 행 선택 시 주의 사항
- 상태 토글(`활성화`/`비활성`)은 현재 상태에 따라 한쪽만 활성화됩니다.
- `가져온 사용자 삭제`는 복구할 수 없으므로 신중히 실행합니다.

---

## 사용자 연동 생성

### 화면 개요

입력 폼은 다음 순서로 구성됩니다.

1) **일반 옵션** → 2) **연결 및 인증 설정** → 3) **LDAP 검색 및 업데이트** → 4) **동기화 설정** → 5) **고급 설정**  
   하단에는 `취소` / `생성` 버튼이 있으며, 중간 단계에서 `연결 테스트`, `인증 테스트` 버튼이 제공됩니다.

### 도구 모음과 주요 작업

- `연결 테스트`: **연결 URL**, **바인드 유형**, **바인드 DN/자격 증명** 등 필수 항목이 올바르게 입력된 경우 활성화되며, LDAP 서버와의 연결 가능 여부를 확인합니다.
- `인증 테스트`: 연결 테스트 성공 후, **바인드 DN/자격 증명**으로 인증이 성공하는지 확인합니다.
- `생성`: 모든 필수 입력이 유효할 때 활성화됩니다.
- `취소`: 편집 내용을 저장하지 않고 생성 페이지를 종료합니다.

---

## 일반 옵션

- **이름**: 사용자연동 설정의 표시 이름입니다. 목록 화면과 상세 상단에 노출됩니다.
- **공급업체**: LDAP 공급업체 유형을 선택합니다. (예: `Active Directory`, `Other` 등)

### 입력 필드 유효성 (UI 기준)

| 필드 | 허용 값/길이 | 검증 규칙 (실시간 메시지 예시)                                                    | 비고 |
|---|---|-----------------------------------------------------------------------|---|
| **이름** | 최대 20자, 영문 대/소문자·숫자·하이픈(`-`) | 허용 외 문자 입력 시 “영문 대/소문자, 숫자, 하이픈만 허용합니다.” / 21자 이상 “최대 20자까지 입력 가능합니다.” | **필수** |
| **공급업체** | 사전 정의 목록에서 선택 |                                                                       | **필수** |

---

## 연결 및 인증 설정

- **연결 URL**: LDAP 접속 주소입니다. `ldap://호스트:포트` 또는 `ldaps://호스트:포트` 형식을 사용합니다.
- **StartTLS 활성화**: 평문 LDAP(`ldap://`) 연결을 TLS로 승격할 때 사용합니다.
- **Truststore SPI 사용**: TLS 인증서 신뢰 저장소 사용 여부를 지정합니다.
- **연결 풀링**: LDAP 연결 재사용을 활성화/비활성화합니다.
- **연결 시간 초과**: LDAP 소켓 연결 타임아웃입니다(밀리초). `0` 입력 시 제한 없음.
- **연결 테스트** 버튼
- **바인드 유형**: `none`(익명) 또는 `simple`(DN+비밀번호) 중 선택합니다.
- **바인드 DN**: LDAP에 바인드할 계정의 DN입니다.
- **바인드 자격 증명**: 바인드 DN 계정의 비밀번호입니다.
- **인증 테스트** 버튼

### 입력 필드 유효성 (UI 기준)

| 필드 | 허용 값/형식 | 검증 규칙 (실시간 메시지 예시) | 비고 |
|---|---|--|---|
| **연결 URL** | `ldap://host:port` 또는 `ldaps://host:port` | 형식 오류 시 “`ldap://` 또는 `ldaps://` 형식으로 입력하세요.” / 호스트·포트 누락 시 “호스트와 포트를 입력하세요.” | **필수** |
| **StartTLS 활성화** | 토글(켜짐/꺼짐) | `ldaps://`와 함께 사용할 경우 경고 “LDAPS 사용 시 StartTLS는 꺼주세요.” | |
| **Truststore SPI 사용** | 토글(켜짐/꺼짐) | | TLS 인증서 검증 시 사용 |
| **연결 풀링** | 토글(켜짐/꺼짐) | | 성능 관련 옵션 |
| **연결 시간 초과** | 정수 ≥ 0 (ms) | | 0=제한 없음 |
| **바인드 유형** | `none` / `simple` | | **필수** |
| **바인드 DN** | DN 문자열 | | **필수** |
| **바인드 자격 증명** | 비밀번호 문자열 | | **필수** |

---

## LDAP 검색 및 업데이트

- **편집 모드**: LDAP과 CloudiA 간 동기화 모드를 지정합니다. (`READ_ONLY` / `WRITABLE` / `UNSYNCED`)
- **사용자 DN**: 사용자 검색의 기준이 되는 Base DN입니다.
- **사용자명 LDAP 속성**: CloudiA `username`에 매핑할 LDAP 속성(예: `uid`, `sAMAccountName`).
- **RDN LDAP 속성**: 사용자 객체의 RDN으로 사용할 속성(예: `cn`).
- **UUID LDAP 속성**: 사용자 객체의 고유 식별자 속성(예: `entryUUID`, `objectGUID`).
- **사용자 객체 클래스**: 사용자 객체에 요구되는 objectClass 목록(쉼표 구분).
- **사용자 LDAP 필터**: 추가 필터(선택). 예: `(&(objectClass=inetOrgPerson)(accountStatus=active))`
- **검색 범위**: `한 수준` / `하위 트리` 중 선택.
- **읽기 시간 초과**: LDAP 조회 타임아웃(밀리초).
- **페이지네이션**: 대량 사용자 조회 시 페이지 처리 사용 여부.
- **참조**: LDAP Referral 처리 사용 여부.

### 입력 필드 유효성 (UI 기준)

| 필드 | 허용 값/형식                               | 검증 규칙 (실시간 메시지 예시) | 비고 |
|---|---------------------------------------|--|----|
| **편집 모드** | `READ_ONLY` / `WRITABLE` / `UNSYNCED` | | **필수** |
| **사용자 DN** | DN 문자열                                | | **필수** |
| **사용자명 LDAP 속성** | 속성명 문자열                               |  | **필수** |
| **RDN LDAP 속성** | 속성명 문자열                               |  | **필수** |
| **UUID LDAP 속성** | 속성명 문자열                               | | **필수** |
| **사용자 객체 클래스** | `class1, class2, ...`                 | | **필수** |
| **사용자 LDAP 필터** | LDAP 필터 구문 “'('로 시작하고 ')'로 끝나야 합니다. |  | 선택 |
| **검색 범위** | `한 수준` / `하위 트리`                      | | **필수** |
| **읽기 시간 초과** | 정수 ≥ 0 (ms)                           | | 선택 |
| **페이지네이션** | `사용` / `사용 안 함`                       | | 많은 사용자 동기화 시 권장 |
| **참조** | 토글(켜짐/꺼짐)                             | | 일반적으로 꺼짐 권장 |

---

## 동기화 설정

- **사용자 가져오기**: LDAP 사용자를 CloudiA에 생성/저장할지 여부(ON 권장).
- **등록 동기화**: CloudiA에서 생성한 사용자를 LDAP에도 생성할지 여부.
- **배치 크기**: 동기화 시 한 트랜잭션에서 처리할 사용자 수.
- **주기적 전체 동기화**: 모든 사용자를 주기적으로 동기화.
- **주기적 변경된 사용자 동기화**: 변경/신규 사용자만 주기적으로 동기화.

### 입력 필드 유효성 (UI 기준)

| 필드 | 허용 값/형식 | 검증 규칙 (실시간 메시지 예시) | 비고           |
|---|---|--|--------------|
| **사용자 가져오기** | 토글(켜짐/꺼짐) | | ON 권장        |
| **등록 동기화** | 토글(켜짐/꺼짐) | |              |
| **배치 크기** | | | 환경에 맞게 조정    |
| **주기적 전체 동기화** | 토글(켜짐/꺼짐) | | -1 인경우 동기화 X |
| **주기적 변경된 사용자 동기화** | 토글(켜짐/꺼짐) | |    -1 인경우 동기화 X   |

---

## 고급 설정

- **LDAPv3 암호 수정 확장 작업 활성화**: LDAPv3 Password Modify 확장 사용 여부.
- **암호 정책 검증**: CloudiA 비밀번호 정책을 LDAP 비밀번호 변경에도 적용.
- **이메일 신뢰**: LDAP 이메일을 검증됨으로 간주.
- **연결 추적**: LDAP 요청 시간/상태를 로깅.

### 입력 필드 유효성 (UI 기준)

| 필드 | 허용 값/형식 | 검증 규칙 (실시간 메시지 예시)         | 비고 |
|---|---|----------------------------|---|
| **LDAPv3 암호 수정 확장 작업 활성화** | 토글(켜짐/꺼짐) |                            | |
| **암호 정책 검증** | 토글(켜짐/꺼짐) |   | 정책 충돌 가능 |
| **이메일 신뢰** | 토글(켜짐/꺼짐) |    | |
| **연결 추적** | 토글(켜짐/꺼짐) |  | 문제 해결 시 사용 |

---

## 생성 버튼 활성 조건

- **필수 입력**(별표 `*`)이 모두 유효하고, `연결 테스트`와 `인증 테스트`가 성공한 경우 `생성` 버튼이 활성화됩니다.
- 오류가 있는 필드는 경고 메시지와 함께 붉은 테두리로 표시됩니다. 수정 후 다시 시도하세요.

---

## 매퍼(목록/상세/생성·편집)

CloudiA 사용자 속성과 LDAP 속성을 연결하는 규칙을 **매퍼**라고 부릅니다. 매퍼는 사용자 동기화/조회 시 프로필 필드에 직접 영향을 줍니다.

### 매퍼 목록

#### 도구 모음과 주요 작업
- `매퍼 생성`: 새 매핑 규칙을 추가합니다.
- `매퍼 수정`: 선택한 매핑 규칙을 편집합니다.
- `매퍼 삭제`: 선택한 매핑 규칙을 제거합니다(확인 창 표시).

#### 테이블 컬럼
| 컬럼 | 설명                                                                                    |
|---|---------------------------------------------------------------------------------------|
| **이름** | 매퍼 표시명,  user-attribute-ldap-mapper 으로 고정                                                                                 |
| **유형** | 매퍼 타입, user-attribute-ldap-mapper 으로 고정                                               |
| **사용자 속성(CloudiA)** | 연결할 CloudiA 사용자 프로필 필드(`username`, `mobileNumber` 등) |
| **LDAP 속성** | 대응되는 LDAP 속성명(예: `uid`, `mail`, `telephoneNumber`)                                    |
| **읽기 전용** | LDAP→CloudiA 단방향 여부                                                                   |
| **항상 LDAP에서 값 읽기** | 조회 시 항상 LDAP 최신값 사용                                                                   |
| **LDAP 필수 값** | 해당 LDAP 속성이 반드시 존재해야 함                                                                |
| **기본값/강제** | 기본값과 이를 LDAP에 쓰는지(강제) 여부                                                              |
| **바이너리** | 바이너리 데이터 여부                                                                           |
| **생성일/수정일** | 등록 및 최종 수정 시각                                                                         |

### 매퍼 상세
- 상단 요약: 이름, 유형, 사용자 속성, LDAP 속성, 읽기 전용, 항상 읽기, LDAP 필수 값, 기본값/강제, 바이너리, 생성일/수정일
- 주요 작업: `편집`, `삭제`

> ⚠️ **주의:** 매퍼 변경은 사용자 프로필 동기화에 **즉시 영향**을 줍니다. 운영 중 필드 매핑을 바꿀 경우 기존 데이터와 충돌이 없는지 **사전 점검** 후 적용하세요.
