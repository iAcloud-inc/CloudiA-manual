# 로드 밸런서

**로드 밸런서**는 다수의 가상 머신 혹은 IP 주소를 대상으로 만들어진 타겟 그룹으로의 부하를 분산시켜주는 기능을 제공합니다.

## 로드 밸런서 목록
### 주요 작업
- `생성`: 새로운 로드 밸런서를 생성합니다.
- `편집`: 선택한 1개 플로팅 IP 설정을 편집할 수 있습니다.
- `삭제`: 선택한 로드밸런서들을 삭제합니다. (삭제 시, 타겟 그룹과 연결이 해제됩니다.)
> ⚠️ **주의:** **시스템에서 자동 생성된 로드 밸런서**(예: 쿠버네티스에 의해 생성)인 경우 `편집` 및 `삭제`가 제한됩니다. 

### 테이블 컬럼
| 컬럼         | 설명                                                                                     |
|------------|----------------------------------------------------------------------------------------|
| **이름**    | 로드 밸런서의 이름입니다. 클릭 시 상세 화면으로 이동합니다.                                                     |
| **생성 방식** | 로드 밸런서가 생성된 출처를 나타냅니다. 수동으로 만든 경우 `수동 생성`, 시스템에서 자동 생성된 경우 `쿠버네티스` 를 표시합니다.            | 
| **VPC**   | 로드 밸런서가 속한 VPC입니다.                                                                     | 
| **서브넷**   | 로드 밸런서 IP가 할당된 서브넷입니다.                                                                 |
| **외부 IP** | 로드 밸런서가 할당된 외부 IP 주소입니다. (내부 타입일 경우 -로 표시)                |
|**부하 분산 알고리즘**| 로드 밸런서의 부하 분산 알고리즘으로 `라운드 로빈`, `가중 라운드 로빈`, `최소 연결`, `가중 최소 연결`, `가중 랜덤 확률` 로 구분됩니다. |                                                                              |                                                                             |
| **설명**    | 로드 밸런서의 설명입니다.                                                                         |
| **생성 일시** | 로드 밸런서의 생성된 날짜와 시간입니다.                                                                 |

## 로드 밸런서 상세
### 상단 요약
- **이름**: 로드 밸런서의 이름입니다. 
- **ID**: 로드 밸런서가 부여받은 ID 입니다.
- **타입**: 로드 밸런서 타입을 표시합니다.`외부` IP를 통한 부하 분산 혹은 `내부` IP, 즉 VM 대역의 IP로 부하 분산을 하는 타입으로 구분됩니다.
- **생성 방식**: 로드 밸런서가 생성된 출처를 나타냅니다. 수동으로 만든 경우 `수동 생성`, 시스템에서 자동 생성된 경우 `쿠버네티스` 를 표시합니다.
- **VPC**: 로드 밸런서가 속한 VPC 입니다.
- **서브넷**: 로드 밸런서 IP가 할당된 서브넷입니다. 
- **내부 IP**: 로드 밸런서가 할당된 내부 IP 주소입니다. 
- **외부 IP**: 로드 밸런서가 할당된 외부 IP 주소입니다. (내부 타입일 경우 -로 표시)
- **부하 분산 알고리즘**: 로드 밸런서가 부하를 분산하는 알고리즘으로 `라운드 로빈`, `가중 라운드 로빈`, `최소 연결`, `가중 최소 연결`, `가중 랜덤 확률` 로 구분됩니다.
- **설명**: 로드 밸런서의 설명입니다.
- **생성 일시**: 로드 밸런서의 생성된 날짜와 시간입니다.

### 하단 탭
`편집` 버튼을 클릭하면 리스너 정보를 수정할 수 있는 **리스너 편집** 화면으로 이동합니다. (리스너 편집 가이드는 아래의 **[리스너 편집]** 항목 참고)
#### 리스너 정보 
  - **ID**: 로드 밸런서 리스너에 부여된 고유 ID입니다. 
  - **프로토콜**: 로드 밸런서 리스너의 프로토콜로 `TCP` 또는 `UDP` 를 표시합니다. 
  - **포트 번호**: 로드 밸런서 리스너의 포트입니다.  
  - **부하 분산 알고리즘**: 로드 밸런서 리스너의 부하 분산 알고리즘으로 `라운드 로빈`, `가중 라운드 로빈`, `최소 연결`, `가중 최소 연결`, `가중 랜덤 확률` 로 구분됩니다.
  - **타겟 그룹**: 로드 밸런서 리스너의 타겟 그룹의 이름과 ID (예: target-group (ID: 123)) 입니다.
  - **설명**: 로드 밸런서 리스너의 설명입니다. 
  - **생성 일사**: 로드 밸런서 리스너의 생성된 날짜와 시간입니다.
  - **모니터링 정보**: 로드 밸런서 리스너의 모니터링 정보로 [보기] 버튼을 클릭하여 조회합니다. 
    - 리스너 부하 분산 알고리즘이 `라운드 로빈`, `가중 라운드 로빈`, `최소 연결`, `가중 최소 연결`인 경우
      - **ID**: 타겟에 부여된 고유 ID입니다.
      - **IP**: 타겟의 IP 주소입니다. 
      - **포트 번호**: 타겟의 포트 번호입니다. 
      - **상태**: 타겟의 상태로 `HEALTHY` 한 경우만 표현됩니다. `UNHEALTHY` 한 타겟의 경우 부하 분산 대상에서 제외되며, 모니터링 대상에서도 제외욉니다. 
      - **가중치**: 타겟의 가중치로 부하 분산 알고리즘이 가중치에 비례하지 않는 경우에도 표시되며, 이 경우 가중치가 아닌 부하 분산 방식에 맞게 부하가 분산되며, `리스너 편집`을 통한 부하 분산 알고리즘 변경이 가능합니다. 다만, 타겟 편집과 마찬가지로 룰이 초기화됨에 따른 트래픽 정보가 초기화됩니다. 
      - **총 연결 수**: 타겟으로 연결된 총 연결 수 입니다. 
      - **패킷 수**: 타겟으로 분산된 패킷 수 입니다. 
      - **바이트 수**: 타겟으로 분산된 바이트 수입니다. 
    - 리스너 부하 분산 알고리즘이 `가중 랜덤 확률`인 경우 위의 항목에서 `총 연결 수`를 제외하여 조회합니다. 

- 사용자는 리스너 탭에서 리스너를 `추가`하거나 `편집`, `삭제`할 수 있습니다. `추가` 버튼을 통해 새로운 리스너를 만들고, 기존 리스너를 선택해 `편집`할 수 있습니다. 편집 시 프로토콜(예: TCP, UDP), 포트 번호, 연결할 타겟 그룹 등을 변경할 수 있습니다.

> 💡 **참고:** External 유형은 외부 IP가 할당되어 외부 접근이 가능합니다.

---

## 로드 밸런서 생성·편집
로드 밸런서 생성 시 바로 리스너를 등록할 수도 있고, 로드 밸런서만 생성할 수도 있습니다. 실제 부하 분산의 경우 리스너까지 등록되어야 동작합니다. <br/>
로드 밸런서 생성 후에는 이름, 설명, 종류, IP 주소 등을 변경할 수 있습니다.
### 1. 기본 정보
- **이름**: 로드 밸런서의 이름을 입력합니다.
- **VPC**: 로드 밸런서가 소속될 VPC 를 선택합니다.
- **서브넷**: 로드 밸런서가 할당받을 내부 IP가 소속된 서브넷을 선택합니다.
- **종류** : 로드 밸런서의 종류를 선택합니다. 외부 접근이 가능해야 하는 경우 `외부`를, 내부 통신으로 부하 분산을 하는 경우 `내부`를 선택합니다. 외부 타입의 경우 외부 IP 자원을 필요로 합니다.
- **외부 IP**: 외부 타입의 경우 사용할 외부 IP 주소를 지정합니다. `자동 할당` 을 선택하면 시스템이 가용한 외부 IP를 자동 선택하며, `수동 할당`을 선택하면 외부 IP 목록에서 특정 IP를 선택해야 합니다. 편집 시 타입을 외부로 변경한 경우, 자동 할당 또는 수동 할당을 선택하며, 수동 할당을 선택하면 외부 IP 목록에서 특정 IP를 선택해야 합니다.
- **내부 IP**: 내부 타입의 경우 사용할 내부 IP 주소를 지정합니다.`자동 할당` 을 선택하면 시스템이 사용자가 선택한 서브넷에서 가용한 내부 IP를 자동 선택하며, `수동 할당`을 선택하면 사용자가 특정 IPv4 주소를 직접 입력합니다. 편집 시 타입을 내부로 변경한 경우, 현재의 내부 IP가 표시되며, 사용자가 작성하여 변경할 수 있습니다.
- **부하 분산 알고리즘**
  - **라운드 로빈 (Round Robin)**: 요청을 모든 서버에 순서대로 균등 분배합니다. 
  - **가중 라운드 로빈 (Weighted Round Robin)**: 서버 가중치에 비례해 순서대로 분배합니다. 
  - **최소 연결 (Least Connection)**: 현재 연결 수가 가장 적은 서버로 분배합니다. 
  - **기중 최소 연결 (Weighted Least Connection)**: (연결 수 + 가중치)를 기준으로 분배합니다. 
  - **가중 랜덤 확률 (Weighted Random Probability)**: 서버 가중치에 비례해 랜덤하게 분배합니다. 
- **설명**: 로드 밸런서에 대한 설명을 입력합니다 (선택 사항).

### 2. 리스너 설정
하나의 로드 밸런서에 여러 개의 리스너 등록이 가능하며, 프로토콜 및 포트가 달라야 합니다. 중복된 경우 생성이 제한됩니다. 하나의 리스너는 하나의 타겟그룹과 매핑됩니다.
- **프로토콜**: 로드 밸런서 리스너의 프로토콜을 `TCP` 또는 `UDP` 를 선택합니다. 
- **포트 번호**: 로드 밸런서 리스너의 포트 번호를 입력합니다. 
- **부하 분산 알고리즘**: 로드밸런서의 부하 분산 알고리즘이 `가중 랜덤 확률`인 경우, 리스너의 알고리즘도 `가중 랜덤 확룔`만 선택할 수 있습니다. <br> 로드 밸런서의 알고리즘이 `가중 랜덤 확률`이 아닌 경우, 리스너의 알고리즘은 `라운드 로빈`, `가중 라운드 로빈`, `최소 연결`, `가중 최소 연결` 중에 선택할 수 있습니다. 이 경우, 각각의 리스너가 다른 분산 알고리즘을 가질 수 있습니다.   
  - **라운드 로빈 (Round Robin)**: 요청을 모든 서버에 순서대로 균등 분배합니다.
  - **가중 라운드 로빈 (Weighted Round Robin)**: 서버 가중치에 비례해 순서대로 분배합니다.
  - **최소 연결 (Least Connection)**: 현재 연결 수가 가장 적은 서버로 분배합니다.
  - **기중 최소 연결 (Weighted Least Connection)**: (연결 수 + 가중치)를 기준으로 분배합니다.
  - **가중 랜덤 확률 (Weighted Random Probability)**: 서버 가중치에 비례해 랜덤하게 분배합니다.
- **타겟 그룹**: 동일한 VPC 하위의 타겟 그룹 리스트에서 하나를 선택합니다. 
- **설명**: 로드 밸런서 리스너에 대한 설명을 입력합니다 (선택 사항).

#### 입력 필드 유효성
| 필드                  | 허용 값                                                         | 검증 규칙                              | 비고 |
|---------------------|--------------------------------------------------------------|------------------------------------|---|
| **이름**              | 영문/숫자/하이픈(`-`)/언더스코어(`_`)                                    | 최대 80자, 공백 불가          | **필수** |
| **종류**              | `외부` \| `내부`                                                 | 값 중 하나를 선택해야 함                     | **필수** |
| **VPC**             | 현재 프로젝트의 VPC 중 1개                                            | 존재하는 VPC만 선택 가능                    | **필수** |
| **서브넷**             | 선택한 VPC의 서브넷                                                 | VPC 하위 서브넷만 선택 가능                  | **필수** |
| **설명**              | 문자열                                                          | 최대 200자                            | 선택 |
| **프로토콜** | `TCP` \| `UDP`                                               | 값 중 하나를 선택해야 함                     | **필수** |
| **포트 번호** | 1–65535(정수)                                                  | 숫자만 입력, 예약·중복 포트 방지(동일 LB 내 중복 불가) | **필수** |
|**부하 분산 알고리즘**| `라운드 로빈` \| `가중 라운드 로빈` \| `최소 연결` \| `가중 최소 연결` \| `가중 랜덤 확률` | 값 중에 하나를 선택해야 함 |**필수**|
| **타겟 그룹** | 기존 타겟 그룹 1개                                                  | VPC 하위 타겟 그룹만 선택 가능                | **필수** |
| **설명** | 문자열                                                          | 최대 200자                            | 선택 |                                                      |

## 리스너 편집 
상세 페이지 하단 탭에서 `편집` 버튼을 누르면 리스너 편집 화면이 열립니다. 이 화면에서는 로드 밸런서에 구성된 리스너 목록과 각 리스너에 매핑된 타겟 그룹을 확인할 수 있습니다.<br/>
로드 밸런서 리스너를 `추가`하거나 `편집`, `삭제`할 수 있습니다. `추가` 버튼을 통해 새로운 리스너를 만들고, 기존 리스너를 선택해 `편집`할 수 있습니다. <편집 시 프로토콜(예: TCP, UDP), 포트 번호, 연결할 타겟 그룹 등을 변경할 수 있습니다. 추가와 편집 항목은 동일합니다. 
> 💡 **참고:** 리스너는 클라이언트 연결을 수신하는 포트/프로토콜 단위를 의미합니다.

| 컬럼        | 설명                                                |
|-----------|---------------------------------------------------|
| **프로토콜**  | 로드 밸런서 리스너의 프로토콜로 `TCP` 또는 `UDP` 를 선택합니다.         |
| **포트 번호** | 로드 밸런서 리스너의 포트 번호로 프로토콜과 조합하여 기존 리스너와 중복될 수 없습니다. |
|**부하 분산 알고리즘**| 로드 밸런서 리스너의 부하 분산 알고리즘으로 로드밸런서의 부하 분산 알고리즘이 `가중 랜덤 확률`인 경우, 리스너의 알고리즘도 `가중 랜덤 확룔`만 선택할 수 있습니다. <br> 로드 밸런서의 알고리즘이 `가중 랜덤 확률`이 아닌 경우, 리스너의 알고리즘은 `라운드 로빈`, `가중 라운드 로빈`, `최소 연결`, `가중 최소 연결` 중에 선택할 수 있습니다. 이 경우, 각각의 리스너가 다른 분산 알고리즘을 가질 수 있습니다. |
| **타겟 그룹** | 로드 밸런서가 속한 VPC 하위의 타겟 그룹으로 하나만 선택합니다.             |
| **설명**    | 로드 밸런서 리스너의 설명을 압력합니다.                            |

> ⚠️ **주의:** **시스템에서 자동 생성된 로드 밸런서**(예: Kubernetes에 의해 생성)인 경우 `편집`이 제한됩니다. 

> ⚠️ **주의:** 로드 밸런서 리스너/타겟 그룹 변경은 로드 밸런서의 상세 화면에서 수행해야 합니다. 

## 로드 밸런서 삭제
**삭제는 여러 개를 동시에 선택하여 실행**할 수 있습니다. 
삭제하고자 하는 로드 밸런서 를 선택하고 `삭제` 버튼을 클릭하면 **로드 밸런서  삭제하시겠습니까?** 라는 확인 창이 나타납니다. 확인을 눌러 삭제합니다.

> ⚠️ **주의:** **시스템에서 자동 생성된 로드 밸런서**(예: Kubernetes에 의해 생성)인 경우 `삭제`가 제한됩니다.

> ⚠️ **주의:** 로드 밸런서 삭제 시 로드 밸런서 하위의 **리스너/타겟 그룹 설정도 함께 제거**됩니다.