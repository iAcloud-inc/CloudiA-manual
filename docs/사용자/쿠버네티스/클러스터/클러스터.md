# CloudiA 쿠버네티스 — 클러스터 관리

## 개요
- 목적  
  CloudiA 콘솔에서 쿠버네티스 **클러스터 생성/확장/삭제**, **상세 모니터링**, **노드 운영**, **네트워크/스토리지 정보 확인**, **Kubernetes 리소스 조회**까지의 전체 절차를 상세히 설명합니다.
- 선행 조건  
  - CloudiA 콘솔 접근 권한 및 대상 **프로젝트 권한**  
  - 사전 준비: **VPC/서브넷/보안 그룹**, 사용 가능한 **쿠버네티스 이미지**(OS+버전)  
  - **CA 인증서** 및 **개인 키** 파일(필수)  
  - (선택) **Cloud-Init** 사용자명/비밀번호  
  - (선택) 로컬 `kubectl` 환경(상세 페이지의 [Config 추출]과 연계)

## 빠른 시작
1. **클러스터 생성**: 쿠버네티스 섹션 **[생성]** → 이름/네트워크/컨트롤 플레인/인증서/Cloud-Init 설정 → **[생성]**.  
2. **상세/연결/모니터링**: 생성 항목 클릭 → [Config 추출]로 kubeconfig 확보 → `kubectl` 연결 → **모니터링** 탭에서 지표 확인(자동 새로고침 설정 가능).  
3. **확장/스토리지**: **컴퓨트** 탭 [워커 노드 추가]로 확장 → **스토리지** 탭 **[스토리지 클래스 생성]/[PVC 생성]** → **리소스** 탭에서 워크로드/이벤트 점검.

## 상세 절차
### 단계 1
#### 1-1. 클러스터 목록
- **표 열**: 클러스터 **이름, ID, 엔드포인트 IP, 상태, 제어 플레인/워커 노드 수**(예: `1/1`).
- **상태**: 아이콘과 함께 활성/비활성 등 표시.
- **상단 버튼**
  - **[생성]**: 신규 클러스터 생성 페이지로 이동.
  - **[삭제]**: 하나 이상 선택 시 활성화. 단, **이미 삭제 중 상태**인 클러스터는 삭제 불가.
- **행 클릭**: **클러스터 이름**을 클릭해 **상세 페이지**로 이동.

#### 1-2. 클러스터 생성
1) **클러스터 이름 지정**  
   - 영문 소문자/숫자 사용, 길이 제한 존재. 유효하지 않은 문자는 즉시 오류 메시지로 안내.  
2) **네트워크 선택**  
   - **VPC/서브넷/보안 그룹**을 드롭다운에서 선택(보안 그룹은 1개 이상).  
3) **컨트롤 플레인 설정**  
   - **이미지**(OS+K8s 버전) 선택 → **부팅 디스크 크기**(예: 기본 64GiB, 필요 시 조정) → **인스턴스 타입** → **노드 수**(일반 1개, 고가용성 3개 권장).  
4) **인증서 업로드(필수)**  
   - **CA 인증서**와 **개인 키** 파일 업로드. 마스터 인증 설정에 사용.  
5) **Cloud-Init 설정**  
   - 사용자명 필수, 비밀번호는 옵션(미설정 시 키 기반 인증 등 별도 접근).  
6) **생성 확인/오류 처리**  
   - 필수값 충족 시 **[생성]** 활성화. 요청 성공 시 목록으로 복귀하며 **생성 중** 상태 표시. 수 분 후 **활성(UP)** 전환 시 사용 가능.  
   - **[취소]**로 즉시 작업 중단 가능. 오류 발생 시 상단 에러 메시지를 확인, 값 수정 후 재시도.

### 단계 2[guide-template.md](docs/_templates/guide-template.md)

#### 2-1. 클러스터 상세 페이지
- **상단 요약**: **클러스터 이름, ID, VPC/서브넷, 엔드포인트 IP(API 서버 IP), 상태, 생성 일시**.
- **[Config 추출]**: kubeconfig 정보 확인/다운로드. 외부 `kubectl`에서 해당 클러스터 접근 가능.

#### 2-2. 모니터링 탭
- **지표/상태 요약 대시보드**  
  - 컨트롤 플레인/워커 노드 상태, 평균 CPU 사용률, 파드 상태(Running/Failed 수) 등.  
  - 임계치에 따라 **노란색/빨간색** 등으로 강조.  
- **자동 새로고침**: 우측 상단에서 주기 설정 또는 수동 새로고침 아이콘으로 갱신.  
- **주의**: 클러스터 **초기화 직후**에는 일부 지표가 준비 전일 수 있음.

#### 2-3. 컴퓨트 탭(노드 운영)
- **노드 목록 열**: **역할(컨트롤 플레인/워커), 노드 이름, 노드 ID, K8s 버전, IP, 인스턴스 타입, 상태, 생성 일시**.  
- **툴바 작업**  
  - **[실행]**: 선택 워커 노드가 NotReady/Pending/오프라인일 때 재가동 요청.  
  - **[워커 노드 추가]**: **클러스터 상태가 UP**일 때만 활성화, 추가 화면으로 이동.  
  - **[워커 노드 삭제]**: **워커 1대 선택** + **컨트롤 플레인 아님** + **생성/삭제 진행 중 아님** → 확인 팝업 후 제거(해당 VM 자원도 종료).  
- **노드 상세**: 노드 이름 클릭 시 **VM 인스턴스 상세**로 이동하여 CPU/메모리, 로그 등 심층 모니터링 가능.

#### 2-4. 네트워크 탭(읽기 전용)
- **연결 정보**: **VPC 이름/ID, 서브넷 이름/ID, 보안 그룹 목록**, **클러스터 엔드포인트 IP**.  
- **변경 방법**: 본 탭에서 수정 불가. 네트워크 구성을 바꾸려면 **클러스터 재생성** 또는 별도 네트워크 메뉴 사용.

#### 2-5. 스토리지 탭
- **상단 전환**: 기본 **[스토리지 클래스]**가 선택됨. **PVC**로 전환 가능.  
- **스토리지 클래스 목록**: **이름, 바인딩 모드, 볼륨 확장 허용 여부** 등.  
- **PVC 목록**: **이름, 용량, 접근 모드(ReadOnlyMany/ReadWriteMany), 상태(Pending/Bound)** 등.  
- **우측 상단 버튼**: 현재 선택된 유형에 따라 **[스토리지 클래스 생성]** 또는 **[PVC 생성]** 제공.

#### 2-6. 워커 노드 추가
1) **시작**: **컴퓨트** 탭 툴바의 **[워커 노드 추가]**(클러스터 **UP**, 컨트롤 플레인 준비 완료 필요).  
2) **설정 입력**  
   - **노드 타입(인스턴스 타입)** 선택(권장 스펙을 드롭다운에서 선택).  
   - **노드 이미지**(OS+K8s 버전) 선택(컨트롤 플레인과 동일 버전 권장).  
   - **부팅 디스크 크기** 설정(기본값 제공, 유효 범위 검증).  
   - **노드 수** 지정(동시에 여러 대 추가 가능, 시스템이 안내하는 **최대 허용 대수** 내—예: 최대 5대 등).  
   - **Cloud-Init 계정**: 사용자명, (옵션) 비밀번호/확인.  
3) **가용 IP 확인**  
   - 대상 **서브넷의 남은 IP 수** 자동 조회. **추가 수 > 가용 IP**면 경고 및 **[생성] 비활성화**.  
4) **추가 실행/취소**  
   - **[생성]** 클릭 → **컴퓨트** 탭으로 복귀, 새 워커가 **생성 중** → 준비 시 **Ready**.  
   - UI 상단에 진행 상황 표시, 필요 시 **[취소]** 가능.  
5) **스케줄링**  
   - 클러스터 스케줄러가 신규 노드를 인지하여 **디플로이먼트/데몬셋**을 재분산. 모니터링 탭에서 리소스 변화 확인.

#### 2-7. 스토리지 클래스 생성
1) **진입**: **스토리지** 탭에서 **[스토리지 클래스]** 선택 상태 → **[스토리지 클래스 생성]**.  
2) **입력 항목**  
   - **이름**: Kubernetes 리소스 명명 규칙(소문자/숫자/`-`) 준수(예: `premium-storage-class`).  
   - **파일 시스템/스토리지 도메인 선택**: **[선택]** 버튼 → 사전 등록된 NFS/CephFS 등에서 연결 대상 지정.  
   - **반환 정책(Reclaim Policy)**: **Delete** 또는 **Retain** 선택(운영 정책에 맞게).  
3) **생성/결과**  
   - **[생성]** 후 스토리지 탭으로 복귀, 목록에 추가. 성공 알림 표시, 오류 시 원인 메시지 확인.  
   - 생성된 클래스는 이후 **PVC 생성 시 지정** 가능.

#### 2-8. PVC 생성
1) **진입**: **스토리지** 탭 상단에서 **PVC** 전환 → **[PVC 생성]**.  
2) **입력 항목**  
   - **이름**: 소문자/숫자/`-` 규칙, 고유해야 함(예: `my-app-pvc`).  
   - **용량**: **MiB 단위 정수(≥1)** 입력(예: `10240` = 10GiB).  
   - **스토리지 클래스**: 드롭다운에서 선택(없으면 먼저 스토리지 클래스를 생성).  
   - **Namespace**: 생성 대상 네임스페이스 선택(예: `default` 또는 앱 전용).  
   - **액세스 모드**: **ReadOnlyMany** 또는 **ReadWriteMany** 중 선택(공유 쓰기 필요 시 RWX).  
3) **생성/상태**  
   - **[생성]** 후 **PVC 목록**에 추가. 초기 **Pending** → 백엔드 볼륨 프로비저닝 완료 시 **Bound**.  
   - **리소스 → 이벤트**에서 `"Successfully provisioned volume"` 등 메시지로 상태 확인.  
4) **사용**  
   - 디플로이먼트/파드 매니페스트에서 해당 PVC를 마운트하여 영구 스토리지 사용.

#### 2-9. 리소스 탭(조회 전용)
- **리소스 종류 선택**: **시스템 파드 / 디플로이먼트 / 서비스 / 데몬셋 / 이벤트**.  
- **시스템 파드**: `kube-system` 등 핵심 컴포넌트(CoreDNS, kube-proxy) 상태/재시작 횟수/노드 배치 확인.  
- **디플로이먼트**: 이름/네임스페이스/준비 파드 수/요구 수/업데이트 일시 등으로 워크로드 현황 파악.  
- **서비스**: 타입(ClusterIP/LoadBalancer 등), 클러스터 IP, 포트, 셀렉터 확인.  
- **데몬셋**: 전 노드 배치형 에이전트(예: 로그 수집기) 현황.  
- **이벤트**: 시간순 로그(타입 Normal/Warning, 메시지, 발생 시각, 관련 객체)로 클러스터 내 주요 상황 파악.  
- **수정 작업은 미제공**: 표시는 조회 전용. 문제 발견 시 `kubectl`/CI/CD 등 외부 도구로 조치.

## 변경 이력
- 2025-10-14: 최초 작성
