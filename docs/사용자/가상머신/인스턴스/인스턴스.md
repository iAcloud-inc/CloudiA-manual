# 인스턴스 사용자 가이드

CloudiA 콘솔의 **인스턴스** 메뉴는 프로젝트에 속한 가상머신을 생성·조회·관리하는 공간입니다. 이 문서는 실제 화면 구성을 기준으로 목록, 상세, 생성/편집 흐름을 단계별로 설명하고, 각 입력 필드의 유효성 규칙을 표 형태로 정리합니다. 모든 용어와 상태명은 Synergia Frontend `develop` 브랜치에서 사용하는 UI 표기를 그대로 따릅니다.

## 한눈에 보기

- **인스턴스 목록**: 전체 가상머신의 이름, 상태, 생성 방식 등을 테이블로 확인하고, 전원 제어·스냅샷·라이브 마이그레이션 같은 즉시 작업을 실행합니다.
- **인스턴스 상세**: 선택한 가상머신의 기본 정보와 네트워크/스토리지/모니터링/스냅샷 등 세부 탭을 제공합니다. 콘솔 접속(VNC)도 여기에서 열 수 있습니다.
- **인스턴스 생성·편집**: 마법사 형식으로 자원 사양, 네트워크, 스토리지, Cloud-init 옵션을 설정합니다. 실행 중인 가상머신은 라이브 업데이트로 제한된 항목만 수정할 수 있습니다.

---

## 인스턴스 목록 

### 화면 개요

목록 화면은 상단 도구 모음과 검색 영역, 인스턴스 테이블로 구성됩니다. 행을 선택하면 우측 버튼과 우측 상단 “더보기” 드롭다운에서 추가 작업이 활성화됩니다. 상태가 `생성 중`, `삭제 중`, `에러`일 때에는 상세 화면으로 이동하거나 일부 작업을 실행할 수 없습니다.

### 도구 모음과 주요 작업

- **생성**: 새 인스턴스 생성 화면으로 이동합니다.
- **편집**: 정확히 한 개의 행을 선택했을 때만 활성화되며, 선택한 인스턴스가 `실행 중`, `정지됨`, `종료됨` 상태여야 합니다.
- **삭제**: 한 개의 행을 선택했을 때 사용합니다. `생성 중`, `실행 중`, `삭제 중` 상태인 경우 버튼이 비활성화되며, 자동 생성된 인스턴스(오토 스케일링, 쿠버네티스 등)는 백엔드 정책에 따라 삭제가 거부될 수 있습니다.
- **전원 제어 버튼** (오렌지색 영역)
  - `실행`: 선택한 인스턴스가 `정지됨` 또는 `종료됨`일 때 사용합니다.
  - `종료`: 대상이 `실행 중` 또는 `일시 중지` 상태일 때 전원을 끕니다.
  - `재부팅`: `실행 중`일 때만 활성화됩니다.
- **더보기 ▾** (드롭다운)
  - `스냅샷 생성`: `실행 중`, `종료됨` 상태에서 실행 가능합니다.
  - `라이브 마이그레이션`: `실행 중` 상태에서 다른 호스트로 실시간 이동합니다.

### 검색과 정렬

- 상단 검색창은 **이름** 기준으로 부분 일치를 지원합니다.
- 테이블 헤더를 클릭하면 오름차순/내림차순 정렬을 변경할 수 있습니다.

### 테이블 컬럼

| 컬럼 | 설명                                                    |
| --- |-------------------------------------------------------|
| **이름** | 인스턴스 표시명입니다. 클릭 시 상세 화면으로 이동합니다.                      |
| **ID** | 내부 식별자입니다. API 호출이나 기술 지원시 활용합니다.                     |
| **생성 방식** | `수동 생성`, `오토 스케일링 그룹`, `쿠버네티스`, `파일 시스템` 중 하나로 표시됩니다. |
| **IP** | 가상 네트워크 인터페이스의 첫 번째 IPv4 주소가 표시됩니다.                   |
| **상태** | 현재 동작 상태를 컬러 배지로 보여줍니다. 아래 상태표 참고.            |
| **vCPU** | 현재 할당된 가상 CPU 개수입니다.                                  |
| **메모리** | 현재 할당된 메모리 용량입니다. 표시값은 GiB 단위로 자동 변환됩니다.              |
| **생성 일시** | 콘솔 사용자 로컬 타임존으로 변환된 생성 시각입니다.                         |

### 상태 배지 안내

| 표시 이름 | 의미                      | 권장 후속 조치                                               |
| --- |-------------------------|--------------------------------------------------------|
| **생성 중** | 가상머신 자원 프로비저닝이 진행 중입니다. | 잠시 기다렸다가 상태가 `부팅 중` 또는 `정지됨`으로 변할 때까지 대기합니다.           |
| **부팅 중** | 전원이 켜지며 초기화 중입니다.       | 자동으로 `실행 중`으로 전환됩니다.                                   |
| **실행 중** | 가상머신이 정상적으로 서비스 중입니다.   | 필요 시 `재부팅`, `종료`, `라이브 마이그레이션`, `편집(라이브)`을 사용할 수 있습니다. |
| **일시 중지** | 가상머신이 pause 상태입니다.      | `종료`로 전원 차단 또는 `실행`으로 복구합니다.                           |
| **업데이트 중** | 사양 변경(편집)이 반영되는 중입니다.   | 완료 후 원하는 작업을 다시 시도합니다.                                 |
| **재부팅 중** | 재부팅 요청이 수행 중입니다.        | 완료되면 자동으로 `실행 중`으로 바뀝니다.                               |
| **마이그레이션 중** | 라이브 마이그레이션이 동작 중입니다.    | 작업이 끝날 때까지 전원 제어를 피하세요.                                |
| **종료 중** | 종료(전원 끄기) 명령이 수행 중입니다.  | 완료 후 `정지됨`으로 표시됩니다.                                    |
| **정지됨** | 전원이 꺼져 있으나 자원은 유지됩니다.   | `실행` 또는 `편집`을 수행할 수 있습니다.                              |
| **종료됨** | 종료 이후 자원 정리가 완료된 상태입니다. | `실행`, `편집`, `스냅샷 생성`이 가능합니다.                           |
| **삭제 중** | 삭제 요청이 진행 중입니다.         | 완료되면 행이 목록에서 제거됩니다.                                    |
| **에러** | 백엔드에서 오류를 감지했습니다.       | 작업 기록을 확인하고 필요 시 지원팀에 문의하세요.                           |
| **알 수 없음** | 일시적으로 상태를 확인할 수 없습니다.   | 새로고침 후에도 지속되면 관리자에게 문의하세요.                             |

### 행 선택 시 주의 사항

- `생성 중`, `삭제 중`, `에러` 상태의 인스턴스는 상세 화면으로 이동할 수 없습니다.
- 다중 선택은 지원하지 않으며, 항상 한 행만 선택됩니다.
- 자동 생성된 인스턴스는 정책상 전원 제어나 삭제가 제한될 수 있습니다. 버튼이 비활성화된 경우 툴팁 또는 토스트 메시지를 참고하세요.

---

## 인스턴스 상세 화면

### 상단 요약

상세 화면 상단에는 다음 정보가 표 형태로 정리됩니다.

- 기본 정보: **이름**, **상태**, **UUID**, **ID**, **생성 일시**
- 네트워크: **VPC**, **기본 네트워크 이름**, **Cloud-init 계정 ID**
- 컴퓨트: **인스턴스 타입**(선택한 경우), **GPU 패스스루 사용 여부**, **vCPU 구성(소켓/코어/스레드)**, **메모리 용량**, **최대 vCPU**, **최대 메모리**, **호스트 머신**
- 배포 정보: **생성 방식**, **이미지**, **연결된 시작 템플릿**(있는 경우)

`콘솔` 버튼은 인스턴스가 `실행 중`이고 콘솔 URL이 준비된 경우에만 활성화됩니다. 새 창에서 VNC 콘솔이 열립니다.

### 하단 탭

- **네트워크 인터페이스**: 각 NIC의 서브넷, IP, 보안그룹을 확인합니다. 
- **디스크**: 부팅 디스크와 연결된 블록 디바이스 목록이 표시됩니다. 
- **모니터링**: vCPU 사용률, 메모리 사용량, 디스크 I/O, 네트워크 인터페이스 Inbound/Outbound Traffic 등 주요 지표를 시각화합니다.
- **스냅샷**: 생성된 스냅샷 목록과 복원/삭제 작업을 제공합니다.
- **파일 시스템**:  마운트된 파일 시스템 정보(NFS, VirtioFS)를 확인합니다.
- **Floating IP**: 연결된 플로팅 IP 관리 정보를 보여줍니다.
- **Affinity Group**: 적용된 선호도 그룹을 확인합니다.
- **사용자 스크립트**: Cloud-init 사용자 스크립트(파일명, 실행 순서, 실행 시점)를 확인합니다.

---

## 인스턴스 생성 및 편집

### 작업 모드 구분

- **편집**: 인스턴스가 `정지됨` 또는 `종료됨`일 때 대부분의 설정을 변경할 수 있습니다.
- **편집(실행 중)**: 인스턴스가 `실행 중`이면 전원 제어 없이 일부 항목만 변경할 수 있습니다. 증가형 자원(vCPU, 메모리), 추가 NIC/데이터 디스크 연결이 대표적입니다. 기본 NIC, VPC, 파일 시스템은 라이브 상태에서 수정할 수 없습니다.

### 절차별 안내

#### 1. 기본 정보

- **인스턴스 이름**: 영문 대/소문자, 숫자, 하이픈(-), 밑줄(_)만 사용할 수 있으며 최대 30자입니다. 첫 글자는 숫자가 될 수 없습니다.

#### 2. 인스턴스 구성

- **인스턴스 타입 선택**: 사전 정의된 사양을 선택합니다.
- **직접 입력**: vCPU(1, 2, 4, …, 128)와 메모리(1~512) 값을 직접 선택합니다. 메모리 단위는 GiB 또는 MiB를 선택할 수 있으며, GiB 기준 0.5GiB 단위 증감이 허용됩니다.
- **vCPU 상세 설정**: 하이퍼스레딩(스레드/코어)을 통해 코어당 스레드 수를 조정할 수 있습니다. 인스턴스 타입이 홀수 vCPU라면 상세 설정은 기본값(하이퍼스레딩 Off)으로 고정됩니다.

#### 3. 확장 한도 (핫 플러그)

- **최대 vCPU / 최대 메모리**: 실행 중인 상태에서 늘릴 수 있는 상한을 지정합니다. 현재 값 이상을 입력해야 하며, 기본값의 1.5~2배 이내로 설정하는 것을 권장합니다.

#### 4. 이미지 및 부팅 디스크

- **이미지 선택**: 프로젝트 내 공유 이미지 목록에서 선택합니다.
- **부팅 디스크 크기 조정**: 새 인스턴스를 만들 때만 입력할 수 있으며, 이미지 원본보다 크거나 같은 정수값을 입력해야 합니다.

#### 5. GPU 패스스루

- 인스턴스 타입이 GPU를 지원하면 자동으로 `사용`으로 표시됩니다.
- 직접 입력 모드에서는 토글을 통해 `GPU Passthrough`를 켜거나 끌 수 있습니다.

#### 6. 네트워크 설정

- **VPC 선택**: 첫 번째 네트워크 인터페이스를 추가하면 해당 VPC로 고정되며, 편집 시에는 변경할 수 없습니다.
- **서브넷 및 보안 그룹**: 각 인터페이스마다 서브넷과 보안 그룹(최대 5개)을 선택해야 합니다.
- **기본 IP 지정**: 자동 할당(기본값) 또는 수동 입력을 선택할 수 있습니다. 수동 입력은 IPv4 형식이면서 선택한 서브넷의 CIDR 범위에 속해야 합니다.
- **네트워크 인터페이스 수**: 목록 아래 `현재 인터페이스 개수`를 확인하세요. 100개를 초과할 수 없습니다. `편집(실행 중)` 에서는 기본 NIC를 삭제할 수 없습니다.

#### 7. 스토리지 설정

- **블록 디바이스**: 프로젝트에 존재하는 데이터 디스크(부팅 디스크 제외)를 연결하거나 제거합니다. 라이브 업데이트에서도 데이터 디스크의 추가/제거는 가능합니다.
- **파일 시스템(VirtioFS/NFS)**: 인스턴스가 실행 중일 때는 추가/삭제가 비활성화됩니다. 종료 상태에서만 수정할 수 있습니다.

#### 8. Cloud-init 설정 

- 기본 사용자 계정은 `cloudia`입니다. 사용자명을 입력하지 않으면 자동으로 `cloudia`가 사용됩니다.
- **사용자명**: 영문 소문자로 시작해야 하며, `소문자`/`숫자`/`-`/`_`만 허용됩니다. 길이는 4~20자입니다. 시스템 예약어(예: `root`, `admin` 등)는 사용할 수 없습니다.
- **비밀번호 변경**: `비밀번호 변경` 버튼을 눌러 켠 경우에만 새 비밀번호와 확인 값을 입력합니다. 허용 문자: 영문, 숫자, 특수문자(`!@#$%^&*()_+-=~[]{}<>?,.`). 길이 4~20자이며 두 입력이 일치해야 합니다.
- **사용자 스크립트**: `등록`을 누르면 스크립트 파일을 여러 개 추가할 수 있습니다. 파일명은 255자 이하, 슬래시(`/` 또는 `\`) 금지, 동일한 이름 중복 불가입니다. 콘텐츠는 최대 10,000자까지 입력하며 실행 시점(`PER_BOOT`, `PER_INSTANCE`, `PER_ONCE`)을 지정합니다.

| 구분           | 설명                  |
|--------------|---------------------|
| PER_BOOT     | 매 부팅 시마다 실행         |
| PER_INSTANCE | 인스턴스당 1회(종료 및 실행 포함) |
| PER_ONCE     | 이미지당 1회             |

---

## 입력 필드 유효성 

### 기본 정보 · 컴퓨트

| 구역 | 필드 | 허용 값/길이 | 검증 규칙 (UI 기준) | 비고 |
| --- | --- | --- | --- | --- |
| 기본 정보 | 인스턴스 이름 | 최대 30자, 영문/숫자/`-`/`_` | 첫 글자 숫자 불가, 허용 문자 외 입력 시 “영문 대/소문자, 숫자, 하이픈만 허용합니다.” 메시지 표시 | 필수 |
| 인스턴스 구성 | 인스턴스 타입 | 사전 등록된 타입 | 미선택 시 “선택해주세요” 안내 | 타입에 따라 GPU, 네트워크 한도 자동 반영 |
| 인스턴스 구성 | vCPU (직접 입력) | 1·2·4·8·16·32·64·128 | (라이브 업데이트 시) 기존 값 이상, 스레드/코어=2일 때 짝수만 허용 | 종료 상태 편집은 드롭다운 선택 |
| 인스턴스 구성 | 메모리 (직접 입력) | 1~512 GiB | 0.5GiB 단위, 기존 값보다 작게 입력 시 경고 | MiB 단위 사용 시 512MiB 배수 |
| 확장 한도 | 최대 vCPU | 현재 vCPU 이상 | 현재 값보다 작으면 “현재 값인 X 이상의 값을 입력하세요.” | 라이브 업데이트 중에는 읽기 전용 |
| 확장 한도 | 최대 메모리 | 현재 메모리 이상 | 0.5GiB 단위, 현재 값보다 1GiB 미만 증설 금지 | 단위(MiB/GiB) 변경 가능 |
| 부팅 디스크 | 크기 | 이미지 원본 크기 이상 정수 | 작게 입력 시 “현재 값 이상 입력” 메시지 | 새로 만들 때만 표시 |
| GPU | 패스스루 | 사용/사용 안 함 | 인스턴스 타입 선택 시 상태 고정 | 라이브 업데이트 시 변경 불가 |
| vCPU 상세 | 하이퍼스레딩, 코어/소켓 | 하이퍼스레딩 On/Off, 코어 수는 짝수 | 최대 vCPU 절반 이하, 하이퍼스레딩 Off일 때 홀수 허용 | 인스턴스 타입 vCPU가 홀수면 자동 고정 |

### 네트워크 · 스토리지 · Cloud-init

| 구역 | 필드 | 허용 값/길이 | 검증 규칙 (UI 기준) | 비고 |
| --- | --- | --- | --- | --- |
| 네트워크 | VPC | 프로젝트 내 VPC | 최초 NIC 추가 후 변경 불가 (`편집 모드에서는 변경할 수 없습니다.`) | 필수 |
| 네트워크 | 서브넷 | 선택한 VPC의 서브넷 | VPC 미선택 시 비활성화 | NIC마다 필수 |
| 네트워크 | 기본 IP | 자동 할당 / 수동 IPv4 | 수동일 때 IPv4 형식 및 서브넷 CIDR 범위 검사 | 수동 입력 실패 시 “올바른 IPv4 형식이 아닙니다.”, “CIDR 범위에 속하지 않습니다.” |
| 네트워크 | 보안 그룹 | 최대 5개 | VPC 미선택 시 비활성화, 6개 이상 선택 시 경고 | NIC마다 필수 |
| 네트워크 | 인터페이스 수 | 최대 100개 (타입에 따라 축소) | 제한 초과 시 추가 버튼 비활성화 | 라이브 업데이트 중 기본 NIC 삭제 불가 |
| 스토리지 | 블록 디바이스 | 데이터 디스크 목록 | 부팅 디스크는 목록에 나오지 않음 | 라이브 업데이트에서도 추가/삭제 가능 |
| 스토리지 | 파일 시스템 | VirtioFS/NFS | 라이브 업데이트 중에는 추가/삭제 비활성화 | 종료 상태에서만 수정 가능 |
| Cloud-init | 사용자명 | 4~20자, 소문자/숫자/`-`/`_` | 소문자로 시작해야 하며 예약어 금지 | 미입력 시 `cloudia` 사용 |
| Cloud-init | 비밀번호 | 4~20자, 영문/숫자/특수문자 | 변경 토글이 켜졌을 때만 필수, 확인 값 일치 여부 검사 | 공백 입력 시 기본 이미지 비밀번호 유지 |
| Cloud-init | 사용자 스크립트 파일명 | 최대 255자 | `/` 또는 `\` 사용 불가, 중복 이름 금지 | 각 스크립트는 내용이 1자 이상이어야 함 |
| Cloud-init | 사용자 스크립트 내용 | 최대 10,000자 | 공백 입력 불가 | 실행 시점(`PER_BOOT`, `PER_INSTANCE`, `PER_ONCE`) 지정 |

---