# 인스턴스 

## 인스턴스 목록 

### 주요 작업
- `생성`: 새 인스턴스를 만듭니다. (항상 활성화)
- `편집`: 선택한 **1개** 인스턴스를 수정합니다. 선택 시 활성화되며 상태 제약이 있을 수 있습니다.
- `삭제`: 선택한 **1개** 인스턴스를 삭제합니다. 일반적으로 **전원이 꺼진(정지됨)** 인스턴스에서만 활성화됩니다.
- 전원/상태 제어 (단일 선택 시 표시/활성화)
  - `실행`: 전원을 켭니다. (`정지됨` 등에서 활성)
  - `종료`: 정상 종료합니다. (`실행 중`에서 활성)
  - `재부팅`: 인스턴스를 재시작합니다. (`실행 중`에서 활성)
- `더보기`
  - `스냅샷 생성`: 인스턴스 상태를 스냅샷으로 저장합니다. 진행 중 작업이 없고 `실행 중` 또는 `정지됨`일 때 가능.
  - `라이브 마이그레이션`: `실행 중` 인스턴스를 중단 없이 다른 호스트로 이동합니다.

> 💡 **공통 조건:** 모든 작업은 **한 번에 1개 인스턴스 선택** 기준으로 동작합니다. 상태에 따라 버튼이 자동으로 비활성화될 수 있습니다.

### 테이블 컬럼

인스턴스 목록은 다음과 같은 컬럼으로 구성된 표 형태로 표시됩니다:

| 컬럼        | 설명                                                             |
|-----------|----------------------------------------------------------------|
| **이름**    | 인스턴스 표시명입니다. 클릭 시 상세 화면으로 이동합니다.                               |
| **ID**    | 인스턴스 고유의 ID입니다.                                                |
| **생성 방식** | 인스턴스 생성 방식으로 `수동 생성`, `오토 스케일링 그룹`, `쿠버네티스`, `파일 시스템`으로 구분됩니다. |
| **IP** | NIC에 할당된 IPv4 주소를 표시합니다. 다중 NIC인 경우 쉼표로 구분됩니다.                 |
| **상태**    | `실행 중`, `정지됨`, `생성 중` 등 현재 상태를 배지로 표시합니다.                      |
| **vCPU**  | 할당된 vCPU 개수입니다.                                                |
| **메모리**   | 할당된 메모리(`GiB`)입니다.                                             |
| **생성 일시** | 인스턴스가 생성된 일시입니다.                                               |

### 주의사항
- 일부 인스턴스는 정책/소유권에 따라 `삭제`, `전원 제어`가 제한될 수 있습니다. UI에서 해당 작업은 비활성화되거나 안내 메시지가 표시됩니다.

---

## 인스턴스 상세 

### 상단 요약
- **이름**: 인스턴스 표시명입니다. 
- **상태**: 현재 동작 상태를 배지로 표시합니다.
- **UUID**: 인스턴스를 식별하는 고유값으로 컴퓨트 노드 내 VDSM에서 고유 식별자로 사용됩니다. 
- **ID**: 인스턴스를 식별하는 고유값으로 CloudiA 내에서 고유 식별자로 사용됩니다. 
- **생성 일시**: 생성된 날짜/시간입니다.
- **VPC**: 연결된 가상 네트워크의 이름입니다.
- **인스턴스 타입**: 선택한 사양 이름입니다. (사용 시)
- **GPU**: 패스스루 사용 여부입니다.
- **vCPU**: 현재 할당된 vCPU 자원입니다. 하이퍼스레딩 여부, 코어당 스레드 수, 코어 수가 표시됩니다. 
- **메모리 크기**: 현재 할당된 메모리 자원입니다.
- **최대 vCPU**: 실행 중 확장을 위한 vCPU 상한입니다. 
- **최대 메모리 크기**: 실행 중 확장을 위한 메모리 상한입니다.
- **물리 머신**: 현재 배치된 컴퓨트 노드의 이름 입니다.
- **Cloud-init**: 인스턴스에 설정된 계정/암호가 표시됩니다.
- **생성 방식**: 인스턴스 생성 방식으로 `수동 생성`, `오토 스케일링 그룹`, `쿠버네티스`, `파일 시스템`으로 생성 출처가 표시됩니다.
- **이미지**: 부팅에 사용된 OS 이미지입니다. 

> 💡 **버튼 활성 조건:** `콘솔`은 인스턴스가 **실행 중**일 때만 활성화됩니다.

### 하단 탭
- **네트워크 인터페이스**: 이름, 서브넷, 보안그룹, IP 주소, MAC 정보를 표로 제공합니다. 
  > 💡 네트워크 인터페이스의 변경은 `인스턴스 편집`을 통해 제공합니다. 
- **디스크**: 디스크의 ID, 부팅가능여부, 크기, 논리 장치 이름, 실제 포맷 형식, 블록 디바이스 이름을 표시합니다. 
  > 💡 추가 디스크의 변경은 `인스턴스 편집`을 통해 제공합니다.
- **모니터링**: CPU 사용률·메모리 사용률·디스크 읽기/쓰기·네트워크 사용률(Input/Output) 지표를 그래프로 제공합니다. `기간 선택`, `CSV 내보내기`를 지원합니다.
- **스냅샷**: 스냅샷 목록(스냅샷 이름, 스냅샷 ID, 디스크 이름, 설명, 생성 일시)과 `삭제`, `롤백`을 제공합니다. 롤백은 **전원 꺼짐(정지됨)** 상태에서만 가능합니다. 
  > 💡 새 스냅샷은 인스턴스 목록 화면 `더보기 ▸ 스냅샷 생성`에서 만듭니다.
- **파일 시스템**: 마운트된 파일 시스템 목록(이름, ID, 타입, 크기, 마운트 경로, 생성 일시)을 표시합니다.
  > 💡 파일 시스템의 변경은 `인스턴스 편집`을 통해 제공합니다. 
- **플로팅 IP**: 연결된 공인 IP의 이름/ID/VPC/외부 IP/자원 IP/할당 일시를 표시합니다.
  > 💡 플로팅 IP 연결은 플로팅 IP 상세 화면 연결된 리소스의 `적용`을 통해 제공합니다. 
- **선호도 그룹**: 배치 정책(선호/반선호) 그룹 정보를 제공합니다. 
  > 💡 선호도 그룹의 변경은 선호도 그룹 생성, 상세 화면 가상머신 `편집`에서 제공합니다. 
- **사용자 스크립트**: Cloud-init 사용자 스크립트의 실행 순서, 파일 이름, 경로, 단계, 내용을 표시합니다.

---

## 인스턴스 생성·편집

> 생성과 편집은 같은 양식을 사용합니다. **편집 모드 차이**만 별도 표기합니다.

### 1. 기본 정보
- **인스턴스 이름**: 인스턴스의 이름을 입력합니다.
- **인스턴스 구성**
  - `인스턴스 타입 선택`: 미리 정의된 사양을 선택합니다. 
  - `직접 입력`: vCPU, 메모리를 직접 지정합니다. (단위: `GiB`)
    - `상세 설정`: vCPU의 하이퍼스레딩 사용 여부를 설정합니다.(기본적으로 하이퍼스레딩이 켜져있으며, 코어당 스레드 수가 2 입니다.)
  - *(편집)* **실행 중** 편집은 **vCPU, 메모리 증설(상향)** 만 가능합니다. 감축은 제한됩니다.
- **확장 한도**: 부팅에 사용할 이미지를 선택합니다.
  - `최대 vCPU`: `실행 중`인 인스턴스의 vCPU 증설 상한을 설정합니다.
  - `최대 메모리`: `실행 중`인 인스턴스의 메모리 증설 상한을 설정합니다. 메모리 증설 시 기존보다 최소 1GiB 이상 증설 가능하며, 0.5GiB 단위로 증설 가능합니다.
- **OS 이미지**: 부팅에 사용할 이미지를 선택합니다. 
  *(편집)* 이미지 변경은 **불가**합니다. 
- **이미지 디스크 크기 설정**: 부팅 디스크 크기를 설정합니다. 이미지 기본 크기 이상으로 설정 가능합니다.  
  *(편집)* 변경 **불가**입니다.

#### 입력 필드 유효성
| 필드                      | 허용 값 | 검증 규칙                      | 비고         |
|-------------------------|---------|----------------------------|------------|
| **인스턴스 이름**             | 최대 30자(영문/숫자/`-`) | 첫 글자 숫자 불가, 공백/특수문자 불가     | **필수**     |
| **vCPU**                | 1,2,4,8… (정수) | *(편집)* 현재 값 **이상**만 입력     | 최소 1       |
| **메모리**                 | 정수 또는 0.5 단위 `GiB` | *(편집)* 현재 값 **이상**만 입력     | 단위 `GiB`   |
| **최대 vCPU**             | 1,2,4,8… (정수) | 현재 vCPU 값 **이상**만 입력 | -          |
| **최대 메모리**              | 정수 또는 0.5 단위 `GiB` | 현재 메모리 값 **이상**만 입력  | -          |
| **이미지 디스크 크기 설정** | 이미지 기본 크기 이상 | 소수점 불가                     | 기본값=이미지 크기 |

> ⚠️ **편집:** OS 이미지, 부트 디스크 크기, GPU 패스스루 여부는 변경이 불가합니다.

> ⚠️ **실행 중 편집(라이브 업데이트):** vCPU/메모리 **증설만 가능**합니다. **기본 NIC 삭제** 는 불가합니다.

### 2. 네트워크 인터페이스 구성 
- **네트워크(VPC) 선택**: 연결할 VPC를 지정합니다. *(편집)* VPC 변경은 불가합니다.
- **네트워크 인터페이스(NIC)**
  - **서브넷**: 각 네트워크 인터페이스가 속할 서브넷을 선택합니다.
  - **IP 주소**: 미입력 시 서브넷 내에서 자동 할당, 수동 입력 시 유효한 IPv4 형식 필요.
  - **보안그룹**: 트래픽 규칙 적용 용도로 다중 선택 가능(최대 5개).
- **새 인터페이스 추가/삭제**
  - `새 인터페이스 추가`로 네트워크 인터페이스를 추가합니다. 
  - `삭제`로 설정한 네트워크 인터페이스를 삭제합니다. 
  - *(실행 중)* 비기본 NIC 추가/제거는 가능하며, 발급 받은 IP를 가상 OS에서 수동으로 할당 합니다. 

> 💡 **기본 네트워크 인터페이스:** 첫 번째 가상 네트워크 인터페이스는 기본 네트워크 인터페이스로 *(실행 중)* 제거가 불가능합니다. 

> ⚠️ **실행 중 편집(라이브 업데이트):** 기본 네트워크 인터페이스를 제외한 추가 가상 네트워크 인터페이스의 **증설/삭제 가능**합니다. 

#### 입력/검증 규칙
| 항목 | 설명 | 비고 |
|-----|-----|-----|
| **서브넷** | 선택한 VPC 내 서브넷 중 지정 | – |
| **IPv4 주소** | `A.B.C.D` 형식 유효성 검증 | 미입력 시 자동 할당 |
| **보안그룹** | 다중 선택(최대 5개) | 방화벽 규칙 적용 |

> 💡 VPC 변경이 필요 시 새 인스턴스 생성이 권장됩니다.

### 3. 패스스루(GPU 설정)
- **GPU**: GPU 패스스루 사용 여부를 선택합니다. GPU 호스트 가용성이 필요합니다.  
  *(편집)* 생성 후 **변경 불가**입니다.
> 💡 GPU 인스턴스 수량은 가용 물리 GPU 수량에 의해 제한됩니다.

### 4. 스토리지 추가(추가 디스크)
- **블록**: 블록 목록 중 선택해 부착합니다. 잘못 추가한 항목은 선택 후 `삭제`로 제거합니다.  
- **파일 시스템 추가**: 파일 시스템(NFS, virtiofs) 자원을 선택해 마운트합니다. 
  - virtiofs의 경우 선택한 OS 이미지와 동일한 스토리지 도메인 내의 파일 시스템만 활성화됩니다. 
  - NFS의 경우 입력한 네트워크 인터페이스와 동일한 서브넷의 파일 시스템만 활성화됩니다. 

> ⚠️ **종료/재부팅:** NFS 파일 시스템이 연결된 경우 인스턴스 종료 시 수 분이 소요됩니다.

> ⚠️ **실행 중 편집(라이브 업데이트):** 부팅 디스크를 제외한 추가 블록(데이터 디스크)의 **증설/삭제 가능**합니다.

> ⚠️ **실행 중 편집(라이브 업데이트):** 파일 시스템의 변경이 불가합니다. 

### 5. Cloud-init 설정 
- **사용자 이름**: 인스턴스의 가상 OS 로그인 계정 이름을 설정합니다. 
- **비밀번호**: 인스턴스의 가상 OS 로그인 비밀번호를 설정합니다. 
- **사용자 스크립트**: 인스턴스 부팅 시 자동으로 수행할 사용자 스크립트를 설정합니다. 
  - `등록`으로 여러 개 등록 가능, **실행 순서**대로 처리됩니다. 반복 수행 여부에 따라 `단계`를 설정합니다.
  - **단계**: `PER-BOOT`(부팅 시마다), `PER-INSTANCE`(해당 인스턴스 첫 부팅 1회), `PER-ONCE`(해당 이미지로 최초 1회).
  
#### 입력 필드 유효성
| 필드 | 허용 값                                      | 비고                           |
|------|-------------------------------------------|------------------------------|
| **사용자 이름** | 4~20자, 첫 글자 **영문 소문자** 소문자/숫자/`_`/`-`     | **필수**                       |
| **비밀번호** | 4~20자(영/숫/특수 일부)                          | 미 입력 시 기본 비밀번호(cloudia)로 설정  |


## 인스턴스 삭제 

1. **인스턴스 선택:** 목록 화면에서 삭제하려는 인스턴스를 선택한 뒤,  **`삭제`** 버튼을 클릭합니다.
2. **삭제 확인:** 인스턴스 **삭제 확인** 창이 나타납니다. 
3. **삭제 실행:** 확인 창에서 삭제 대상 인스턴스를 다시 확인한 뒤 **`삭제`** 버튼을 눌러 진행합니다.

> 💡 참고: `종료됨` 상태의 인스턴스만 `삭제` 버튼이 활성화됩니다.

> `생성 방식`이 `수동 생성`인 경우에만 수동 삭제 가능합니다.

> `생성 방식`이 `오토 스케일링 그룹`인 경우 오토 스케일링 화면에서 삭제 가능합니다.

> `생성 방식`이 `쿠버네티스`인 경우 쿠버네티스 화면에서 삭제 가능합니다.

> `생성 방식`이 `파일 시스템`인 경우 NFS 파일 시스템으로 파일 시스템 화면에서 삭제 가능합니다. 

## 인스턴스 라이브 마이그레이션 

> `실행 중` 상태의 인스턴스를 같은 스토리지 도메인 내에서 다른 컴퓨트 노드로 **중단 없이** 이동합니다. 

1. **인스턴스 선택:** 목록 화면에서 라이브 마이그레이션하려는 `실행 중` 상태의 인스턴스를 선택한 뒤,  **`더보기 > 라이브 마이그레이션`** 버튼을 클릭합니다.
2. **대상 물리 머신 선택: ** 같은 스토지리 도메인의 컴퓨트 노드 목록을 조회하여 이동하려는 대상 노드를 선택합니다. 
3. **라이브 마이그레이션 실행: ** `실행` 버튼을 눌러 라이브 마이그레이션을 실행합니다. 

> 💡 참고: `라이브 마이그레이션` 실행 시 상태가 '마이그레이션 중'으로 변경되며, 수 분이 소요될 수 있습니다. 

## 인스턴스 스냅샷 

> 