# 인스턴스 사용자 가이드

## 인스턴스 목록

### 도구 모음과 주요 작업
- **`생성`**: 새 가상머신 생성 화면으로 이동합니다.
- **`편집`**: 정확히 한 개의 인스턴스를 선택한 경우 활성화됩니다. 대상 인스턴스의 상태가 `실행 중`, `정지됨` 또는 `종료됨`이어야 합니다.
- **`삭제`**: 한 개의 인스턴스를 선택했을 때 사용합니다. 인스턴스 상태가 `생성 중`, `실행 중`, `삭제 중`이면 버튼이 비활성화됩니다. 또한 오토스케일링 그룹이나 쿠버네티스 등 **자동 생성**된 인스턴스는 내부 정책에 따라 삭제가 제한될 수 있습니다.
- **전원 제어** (오렌지색 버튼):
    - **`실행`**: 선택한 인스턴스가 `정지됨` 또는 `종료됨` 상태일 때 전원을 켭니다.
    - **`종료`**: 선택한 인스턴스가 `실행 중` 또는 `일시 중지` 상태일 때 전원을 끕니다.
    - **`재부팅`**: 대상 인스턴스가 `실행 중`일 때만 활성화되며, 가상머신을 재시작합니다.
- **더보기 ▼** (드롭다운 메뉴):
    - **`스냅샷 생성`**: 인스턴스 상태가 `실행 중` 또는 `종료됨`일 때 현재 상태를 스냅샷으로 저장합니다.
    - **`라이브 마이그레이션`**: `실행 중`인 인스턴스를 중단 없이 다른 호스트로 실시간 이동합니다.

### 테이블 컬럼
| 컬럼 | 설명 |
|------|------|
| **이름** | 인스턴스 표시 이름입니다. 클릭하면 해당 인스턴스의 상세 화면으로 이동합니다. |
| **ID** | 인스턴스의 내부 식별자입니다. API 호출이나 기술 지원 시 활용됩니다. |
| **생성 방식** | `수동 생성`, `오토 스케일링 그룹`, `쿠버네티스`, `파일 시스템` 중 하나로 표시됩니다. |
| **IP** | 첫 번째 가상 NIC에 할당된 IPv4 주소를 보여줍니다. |
| **상태** | 현재 인스턴스의 동작 상태를 컬러 배지로 표시합니다. (각 상태별 의미는 아래 표를 참고하세요.) |
| **vCPU** | 현재 할당된 가상 CPU 개수입니다. |
| **메모리** | 현재 할당된 메모리 용량입니다. (GiB 단위로 표시) |
| **생성 일시** | 인스턴스 생성 시각으로, 콘솔 사용자의 로컬 시간대 기준으로 표시됩니다. |

**상태 배지 안내:**

| 상태 | 의미 | 후속 조치 권장 사항 |
|------|-----------------|------------------------------|
| **생성 중** | 가상머신 자원을 프로비저닝(생성)하는 중입니다. | 잠시 기다렸다가 상태가 `부팅 중`이나 `정지됨`으로 바뀔 때까지 대기합니다. |
| **부팅 중** | 전원을 켜고 초기화하는 중입니다. | 완료되면 자동으로 `실행 중` 상태로 전환됩니다. |
| **실행 중** | 가상머신이 정상적으로 동작 중입니다. | 필요에 따라 `재부팅`, `종료`, `라이브 마이그레이션`, `편집(라이브)` 등을 사용할 수 있습니다. |
| **일시 중지** | 가상머신을 일시 정지(paused)한 상태입니다. | `실행` 버튼으로 재개하거나 `종료`로 전원을 끌 수 있습니다. |
| **업데이트 중** | 편집으로 사양 변경 사항을 적용하는 중입니다. | 적용 완료 후 원하는 작업을 다시 시도합니다. |
| **재부팅 중** | 재부팅 명령을 수행하는 중입니다. | 완료 후 자동으로 `실행 중`으로 전환됩니다. |
| **마이그레이션 중** | 라이브 마이그레이션 작업 진행 중입니다. | 종료될 때까지 전원 제어 등의 작업을 피합니다. |
| **종료 중** | 전원 끄기(종료) 명령을 처리하는 중입니다. | 완료되면 상태가 `정지됨`으로 변경됩니다. |
| **정지됨** | 전원이 꺼져 있으나 자원은 유지된 상태입니다. | 필요한 경우 `실행`하거나 `편집`을 수행할 수 있습니다. |
| **종료됨** | 종료 후 자원 정리가 완료된 상태입니다. | `실행`, `편집`, `스냅샷 생성` 작업이 가능합니다. |
| **삭제 중** | 인스턴스 삭제 요청을 처리하는 중입니다. | 완료되면 목록에서 해당 인스턴스가 제거됩니다. |
| **에러** | 인스턴스에서 오류가 발생한 상태입니다. | 이벤트/작업 기록을 확인하고 필요 시 지원팀에 문의합니다. |
| **알 수 없음** | 일시적으로 상태 정보를 가져올 수 없습니다. | 새로고침 후에도 계속 표시되면 관리자에게 문의하세요. |

### 주의 사항
- 상태가 `생성 중`, `삭제 중`, `에러`인 인스턴스는 상세 화면으로 이동할 수 없습니다.
- 인스턴스 목록에서는 **다중 선택이 불가능**하며, 항상 하나의 행만 선택할 수 있습니다.
- 자동 생성된 인스턴스는 정책상 일부 작업(전원 제어, 삭제 등)이 제한될 수 있습니다. 버튼이 비활성화된 경우 툴팁이나 안내 메시지를 확인하세요.

## 인스턴스 상세

### 상단 요약
상세 화면 상단에는 인스턴스의 주요 정보가 표 형식으로 요약되어 표시됩니다.
- **기본 정보**: 인스턴스 **이름**, **상태**, **UUID**, **ID**, **생성 일시**를 보여줍니다.
- **네트워크**: 인스턴스가 속한 **VPC**와 **기본 네트워크 이름**, Cloud-init **계정 ID**를 표시합니다.
- **컴퓨트**: 선택한 **인스턴스 타입**(있는 경우), **GPU 패스스루** 사용 여부, vCPU **소켓/코어/스레드** 구성, **메모리 용량**, 설정된 **최대 vCPU** 및 **최대 메모리**, 그리고 현재 인스턴스가 실행 중인 **호스트 머신** 정보를 나타냅니다.
- **배포 정보**: 인스턴스 **생성 방식**, 사용한 **이미지 이름**, 연결된 **시작 템플릿**(있는 경우)을 표시합니다.
- **콘솔 접속**: 상단의 `콘솔` 버튼을 통해 VNC 콘솔 창을 열 수 있습니다. (인스턴스가 `실행 중`이고 콘솔 URL이 준비된 경우에만 활성화)

### 하단 탭
상세 화면 하단에는 인스턴스의 세부 정보를 확인하거나 부가 작업을 수행하는 여러 탭이 있습니다:
- **네트워크 인터페이스**: 연결된 NIC의 서브넷, IP 주소, 보안그룹을 테이블로 보여줍니다.
- **디스크**: 부팅 디스크와 연결된 데이터 디스크(블록 디바이스) 목록을 표시합니다.
- **모니터링**: vCPU 사용률, 메모리 사용량, 디스크 I/O, 네트워크 트래픽 등 주요 자원 지표를 실시간 그래프로 시각화합니다.
- **스냅샷**: 이 인스턴스로부터 생성된 스냅샷 목록을 보여주며, 개별 스냅샷에 대해 **복원** 또는 **삭제**를 수행할 수 있습니다.
- **파일 시스템**: 인스턴스에 마운트된 파일 시스템(VirtioFS 또는 NFS) 정보를 표시합니다.
- **플로팅 IP**: 인스턴스에 연결된 Floating IP의 정보와 관리 옵션을 제공합니다.
- **어피니티 그룹**: 이 인스턴스에 적용된 어피니티/안티-어피니티 그룹 정보를 확인합니다.
- **사용자 스크립트**: Cloud-init 사용자 스크립트의 파일명, 실행 순서, 실행 시점을 목록으로 보여줍니다.

## 인스턴스 생성·편집

인스턴스 생성 및 편집 화면은 마법사 형식으로 단계별 설정을 입력받습니다. **편집 모드**에서는 인스턴스 상태에 따라 변경 가능한 항목이 달라집니다:
- 인스턴스가 `정지됨` 또는 `종료됨` 상태라면 대부분의 설정을 변경할 수 있습니다.
- 인스턴스가 `실행 중`인 경우 전원을 끄지 않고 **라이브 편집**을 수행합니다. 이때 vCPU·메모리 **증가**나 NIC/디스크 **추가** 등 **일부 항목만** 수정 가능하며, 기본 NIC, VPC, 파일 시스템 등은 변경할 수 없습니다.

아래는 단계별 설정 항목과 동작을 정리한 것입니다.

#### 1. 기본 정보
- **인스턴스 이름**: 가상머신의 이름을 지정합니다. 영문 대소문자, 숫자, `-`(하이픈), `_`(밑줄)만 사용할 수 있고 최대 길이는 30자입니다. **첫 글자를 숫자로 시작할 수 없습니다.**

#### 2. 인스턴스 구성
- **인스턴스 타입 선택**: 미리 정의된 vCPU/메모리 사양을 선택합니다. 타입에 GPU 리소스가 포함되어 있다면 GPU 패스스루 항목이 자동으로 `사용`으로 설정됩니다.
- **직접 입력**: vCPU 개수(예: 1, 2, 4, …, 128)와 메모리 용량을 직접 입력합니다. 메모리는 GiB 또는 MiB 단위를 선택할 수 있으며 GiB 단위에서는 0.5 GiB 단위 증감이 가능합니다.
- **vCPU 상세 설정**: 하이퍼스레딩(코어당 2스레드 등) 설정을 변경할 수 있습니다. 예를 들어, 스레드/코어 값을 2로 지정하면 하이퍼스레딩을 활성화(On)하는 것입니다. 인스턴스 타입의 vCPU 개수가 홀수라면 하이퍼스레딩 옵션은 자동으로 Off로 고정됩니다.

#### 3. 확장 한도 (핫 플러그)
- **최대 vCPU / 최대 메모리**: 실행 중인 인스턴스에 대해 동적으로 추가 가능한 vCPU와 메모리의 상한을 설정합니다. 현재 할당된 값 **이상**으로만 지정할 수 있으며, 일반적으로 현재 값의 1.5배~2배 이내로 설정하는 것을 권장합니다.

#### 4. 이미지 및 부팅 디스크
- **이미지 선택**: 프로젝트 내에서 사용할 베이스 이미지를 선택합니다.
- **부팅 디스크 크기**: 기본 이미지 크기보다 크거나 같은 값을 입력합니다. (이미지 원본보다 작게 입력할 수 없으며, 이 필드는 **신규 인스턴스 생성**시에만 수정 가능합니다.)

#### 5. GPU 패스스루
- GPU 자원을 지원하는 인스턴스 타입을 선택하면 GPU 패스스루 옵션이 자동으로 `사용` 설정됩니다.
- 직접 사양 입력 모드에서는 GPU 패스스루 사용 여부를 토글 스위치로 켜거나 끌 수 있습니다.

#### 6. 네트워크 설정
- **VPC 선택**: 첫 번째 네트워크 인터페이스 추가 시 대상 VPC를 선택합니다. 한 번 설정된 VPC는 해당 인스턴스의 기본 VPC로 고정되며, **편집 모드에서는 변경할 수 없습니다**.
- **서브넷 및 보안그룹**: 각 네트워크 인터페이스마다 연결할 **서브넷**과 최대 5개의 **보안그룹**을 지정합니다.
- **IP 할당 방식**: 기본은 **자동 할당**으로, 선택한 서브넷 내 가용 IP가 자동 설정됩니다. 수동으로 특정 IP를 사용하려면 **수동 입력**으로 전환하고 IPv4 주소를 직접 입력합니다. (수동 IP는 올바른 IPv4 형식이어야 하고 선택한 서브넷의 CIDR 범위에 속해야 합니다.)
- **네트워크 인터페이스 개수**: 현재 추가된 NIC 수를 표시하며, 최대 100개까지 NIC를 연결할 수 있습니다. **라이브 편집** 상태에서는 기본 NIC를 삭제할 수 없으며, 인스턴스 타입에 따라 NIC 최대 개수가 100보다 적게 제한될 수 있습니다.

#### 7. 스토리지 설정
- **블록 디바이스**: 인스턴스에 연결할 추가 디스크(데이터 디스크)를 선택합니다. 이미 연결된 디스크를 **제거**하거나 연결 가능한 새 디스크를 **추가**할 수 있습니다. (부팅 디스크는 항상 포함되며 목록에 표시되지 않습니다.) 실행 중인 인스턴스에서도 데이터 디스크의 추가/제거 작업이 가능합니다.
- **파일 시스템**: VirtioFS 또는 NFS 타입의 파일 시스템을 마운트하거나 연결 해제합니다. 인스턴스가 실행 중일 때는 해당 설정을 변경할 수 없으며, **정지됨** 상태에서만 추가/삭제가 가능합니다.

#### 8. Cloud-init 설정
- **기본 계정 사용자명**: Cloud-init으로 생성될 기본 리눅스 계정 이름입니다. 입력하지 않으면 기본값 `cloudia`가 사용됩니다. 사용자명은 영문 소문자로 시작해야 하고 소문자/숫자/`-`/`_`만 사용할 수 있습니다. (길이 4~20자, 시스템 예약어는 사용할 수 없음)
- **비밀번호 설정**: 기본 계정의 초기 비밀번호를 변경하려면 `비밀번호 변경` 옵션을 켭니다. 새 비밀번호와 확인 값을 입력해야 하며, 영문/숫자/특수문자 조합 4~20자로 두 값이 일치해야 합니다. (비밀번호 변경 옵션을 끄면 기본 이미지의 설정을 그대로 사용합니다.)
- **사용자 스크립트**: 초기 부팅 시 실행할 스크립트를 추가로 등록할 수 있습니다. `등록` 버튼을 통해 스크립트 파일을 여러 개 추가할 수 있으며, 각 스크립트는 고유한 **파일명**(255자 이내, `/` 및 `\` 문자는 사용 불가)과 내용을 가져야 합니다. 스크립트 내용은 최대 10,000자까지 입력 가능하며, 각 스크립트별로 **실행 시점**을 지정해야 합니다:
    - **PER_BOOT** – 인스턴스 **부팅 시마다** 실행
    - **PER_INSTANCE** – 해당 인스턴스에서 **최초 한 번만** 실행 (인스턴스가 종료 후 다시 실행되더라도 재실행되지 않음)
    - **PER_ONCE** – 해당 이미지로부터 생성된 **첫 인스턴스에만** 실행 (동일 이미지로 만든 다른 인스턴스에는 실행되지 않음)

각 단계별 입력 필드의 허용 값과 검증 규칙은 아래 표를 참고하세요.

| 구역           | 필드             | 허용 값/범위                | 검증 규칙 (UI)                           | 비고                   |
|----------------|------------------|-----------------------------|------------------------------------------|------------------------|
| **기본 정보**  | 인스턴스 이름    | 최대 30자<br>(영문/숫자/`-`/`_`) | 첫 글자 숫자 불가<br>허용 범위를 벗어난 문자를 입력하면 **"영문 대/소문자, 숫자, 하이픈만 허용합니다."** 오류 표시 | 필수 입력 |
| **인스턴스 구성** | 인스턴스 타입  | 사전 정의된 타입 목록        | 미선택 시 "선택해주세요" 안내            | 타입에 따라 자원 자동 설정 |
| *(직접 입력)*  | vCPU             | 1, 2, 4, 8, …, 128          | **라이브 편집 중**에는 현재 값 이상만 입력 가능<br>하이퍼스레딩 적용 시 짝수만 허용 | 종료 상태 편집은 드롭다운 선택 |
| *(직접 입력)*  | 메모리           | 1 ~ 512 (GiB 단위)          | 0.5 GiB 단위 증감<br>현재 값보다 작게 입력 시 경고 표시 | MiB 단위 사용 시 512 MiB 배수 |
| **확장 한도**   | 최대 vCPU        | 현재 vCPU 이상              | 현재 값 미만 입력 시 "**현재 값인 X 이상의 값을 입력하세요.**" 오류 | 라이브 편집 중에는 수정 불가 |
| **확장 한도**   | 최대 메모리      | 현재 메모리 이상            | 0.5 GiB 단위<br>현재 값보다 1 GiB 미만으로 증가시키면 오류 | 단위 GiB/MiB 변경 가능 |
| **부팅 디스크** | 크기             | 이미지 크기 이상 (정수)      | 더 작은 값 입력 시 "**현재 값 이상 입력**" 오류 메시지 | 새 인스턴스 생성시에만 설정 |
| **GPU**        | 패스스루         | 사용 / 사용 안 함           | 인스턴스 타입 선택 시 상태 자동 지정     | 라이브 편집 시 변경 불가 |
| **vCPU 상세**   | 하이퍼스레딩<br>코어 구성 | 하이퍼스레딩 On/Off<br>코어 수는 최대 vCPU의 절반까지 | 하이퍼스레딩 Off일 때 홀수 코어 구성 허용<br>코어 수는 최대 vCPU의 절반 이하로 설정 | 인스턴스 타입 vCPU가 홀수면 옵션 고정 |
| **네트워크**    | VPC             | 프로젝트 내 VPC 목록         | 최초 NIC 추가 후 **편집 모드에서 변경 불가**<br>(시도 시 "편집 모드에서는 변경할 수 없습니다." 안내) | 필수 선택 |
| **네트워크**    | 서브넷           | 선택한 VPC의 서브넷 목록     | VPC 미선택 시 설정 불가                   | NIC별 필수 |
| **네트워크**    | 기본 IP          | 자동 할당 / 수동 입력        | 수동 입력 시 IPv4 형식 및 서브넷 범위 검사<br>형식 불일치 시 "**올바른 IPv4 형식이 아닙니다.**"<br>범위 벗어나면 "**CIDR 범위에 속하지 않습니다.**" 오류 | NIC별 하나씩 지정 |
| **네트워크**    | 보안 그룹        | 최대 5개                     | VPC 미선택 시 설정 불가<br>6개 이상 선택 시 경고 표시 | NIC별 필수 |
| **네트워크**    | 인터페이스 개수  | 1 ~ 100개                   | 최대치 초과 시 추가 버튼 비활성화         | 라이브 편집 중 기본 NIC 삭제 불가 |
| **스토리지**    | 블록 디바이스    | 데이터 디스크 목록           | 부팅 디스크는 목록에 표시되지 않음        | 라이브 편집에서도 추가/삭제 가능 |
| **스토리지**    | 파일 시스템      | VirtioFS 또는 NFS           | 라이브 편집 중에는 추가/삭제 불가         | 인스턴스 종료 상태에서만 가능 |
| **Cloud-init** | 기본 사용자명    | 4 ~ 20자<br>(소문자/숫자/`-`/`_`) | 영문 소문자로 시작<br>예약어는 사용 불가   | 미입력 시 `cloudia` 사용 |
| **Cloud-init** | 비밀번호         | 4 ~ 20자<br>(영문/숫자/특수문자) | 변경 옵션 활성화 시 필수<br>확인 값과 일치해야 함 | 공백 입력 시 기존 이미지 비밀번호 유지 |
| **Cloud-init** | 스크립트 파일명   | 최대 255자                  | `/` 및 `\` 문자는 사용 불가<br>동일 이름 중복 불가 | 각 스크립트 내용 1자 이상 필요 |
| **Cloud-init** | 스크립트 내용    | 최대 10,000자               | 공백만으로 입력 불가                     | 실행 시점(PER_* 옵션) 지정 필요 |
