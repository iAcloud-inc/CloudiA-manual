# 타겟 그룹

**타겟 그룹**은 로드 밸런서가 트래픽을 분산시킬 대상 서버 그룹입니다.

## 타겟 그룹 목록
### 주요 작업
- **타겟 그룹 목록 화면** 상단에는 `생성`, `편집`, `삭제` 버튼과 검색 기능이 있습니다.
- 타겟 그룹을 선택하면 `편집`(한 개 선택 시)과 `삭제` 버튼이 활성화됩니다. 여러 타겟 그룹을 동시에 삭제할 수도 있습니다.
- `생성` 버튼을 눌러 새 타겟 그룹을 만들 수 있습니다. `편집` 버튼은 타겟 그룹의 설정(이름, 상태 검사 등)을 수정하는 화면으로 이동합니다.

### 테이블 컬럼
| 컬럼         | 설명                                                                                                                 |
|------------|--------------------------------------------------------------------------------------------------------------------|
| **이름**    | 타겟 그룹의 이름입니다. 클릭 시 상세 화면으로 이동합니다.                                                                                  |
| **생성 방식**    | 	해당 타겟 그룹의 생성 출처입니다. 사용자가 직접 생성한 경우 `수동 생성`으로, 시스템 (예: 쿠버네티스, 오토 스케일링 그룹)에서 생성한 경우 `쿠버네티스` 또는 `오토 스케일링 그룹`이 표시됩니다. |
| **VPC**    | 	타겟 그룹이 속한 VPC입니다.                                                                                                 |
| **프로토콜**    | 	타겟 그룹이 사용하는 통신 프로토콜입니다 (예: TCP, UDP).                                                                             |
| **포트 번호**    | 	타겟 그룹의 대상 포트 번호입니다.                                                                                               |
| **타겟 유형**    | 	타겟 그룹의 대상 타입을 표시합니다. `인스턴스` 또는 `IP`로 구분됩니다.                                                                       |
| **로드 밸런서**    | 	해당 타겟 그룹을 현재 사용 중인 로드 밸런서 존재 여부입니다. Y이면 하나 이상의 로드 밸런서에 연결되어 있고, -는 연결된 로드 밸런서가 없음을 의미합니다.                         |
| **생성 일시**    | 	타겟 그룹이 생성된 날짜와 시간입니다.                                                                                             |

## 타겟 그룹 상세
### 상단 요약
- **이름**:	타겟 그룹 이름입니다. 
- **ID**: 타겟 그룹이 부여받은 ID 입니다. 
- **생성 방식**:	해당 타겟 그룹의 생성 출처입니다. 사용자가 직접 생성한 경우 `수동 생성`으로, 시스템 (예: 쿠버네티스, 오토 스케일링 그룹)에서 생성한 경우 `쿠버네티스` 또는 `오토 스케일링 그룹`이 표시됩니다.
- **VPC**:	타겟 그룹이 속한 VPC 입니다.
- **프로토콜**:	타겟 그룹이 사용하는 통신 프로토콜입니다 (예: TCP, UDP).
- **포트 번호**:	타겟 그룹의 대상 포트 번호입니다. 
- **타겟 유형**:	타겟 그룹의 대상 타입을 표시합니다. 인스턴스 또는 IP로 구분됩니다.
- **로드 밸런서**:	해당 타겟 그룹을 현재 사용 중인 로드 밸런서입니다. 예를 들어 “lb-01” 형식으로 현재 이 타겟 그룹을 사용 중인 로드 밸런서 이름이 나옵니다 (없으면 "-").
- **Health Check**
  - **프로토콜**: 타겟 그룹의 상태 검사가 사용하는 통신 프로토콜입니다 (예: TCP, UDP).
  - **포트 번호**: 타겟 그룹의 상태 검사 포트 번호입니다. 
  - **간격**: 타겟 그룹의 상태 검사 간격입니다. (30초)
  - **임계치**: 타겟 그룹의 상태 검사 실패에 대한 임계치입니다. 예를 들어, 2인 경우 간격(30초)마다 두 번 상태 검사가 실패하는 경우 해당 타겟으로 트래픽이 분산되지 않습니다.   
- **생성 일시**:	타겟 그룹이 생성된 날짜와 시간입니다.
- **설명**: 타겟 그룹의 설명입니다. 

### 하단 탭
- **타겟**: 타겟 그룹에 구성된 각 타겟의 목록과 상태를 보여줍니다. 
- 타겟 그룹의 타입이 인스턴스라면 인스턴스 이름과 ID, 상태(예: HEALTHY/UNHEALTHY)가 표시되고, 대상 타입이 IP 라면 IP 주소 목록이 표시됩니다. 
- 각 타겟의 상태(헬스 체크 통과 여부)를 함께 보여주며, 필요 시 타겟 추가/제거 작업을 수행할 수 있습니다.
  - **인스턴스**: 타겟 그룹의 타입이 인스턴스인 경우, 인스턴스 이름과 ID 입니다. (예: vm-01(ID: 29)) 
  - **인터페이스**: 타겟 그룹의 타입이 인스턴스인 경우, 인스턴스의 인터페이스 이름과 IP 주소입니다. (예: eth0(172.31.1.4))
  - **IP 주소**: 타겟 그룹이 타입이 IP인 경우, IP 주소입니다. 
  - **포트 번호**: 타겟의 포트 번호입니다. 
  - **가중치**: 타겟의 가중치입니다. 
  - **상태**: 타겟의 상태입니다. (예: HEALTHY/UNHEALTHY)

> 💡 타겟의 상태가 Unhealthy 한 경우, 트래픽이 분산되지 않습니다. 
 
## 타겟 그룹 생성
타겟 그룹 생성 시 바로 타겟을 등록할 수도 있고, 타겟 그룹만 생성할 수도 있습니다. 실제 부하 분산의 경우 로드밸린서 리스너의 타겟 그룹으로 등록되어야 동작합니다. 
### 1. 기본 정보
- **이름**: 타겟 그룹의 이름을 입력합니다.
- **VPC**: 타겟 그룹이 소속될 VPC 를 선택합니다.
- **프로토콜**: 타겟 그룹이 사용하는 통신 프로토콜을 선택합니다 (예: TCP, UDP). 타겟의 기본 프로토콜로 사용됩니다. 
- **포트 번호**: 타겟 그룹의 수신할 포트 번호를 입렵합니다. 타겟의 기본 포트 번호로 사용됩니다. 
- **타겟 유형**: `인스턴스` 또는 `IP 주소`를 선택합니다. 인스턴스를 선택하면 타겟 풀에 프로젝트 인스턴스를 추가할 수 있고, IP 주소를 선택하면 임의의 IP 주소들을 추가하게 됩니다.

### 2. 고급 상태 검사 설정 (선택)
타겟 그룹과 상태 검사 설정을 다르게 할 수 있습니다. 별도로 설정하지 않으면 타겟 그룹과 동일하게 설정됩니다. 상태 검사 결과 healthy 하여도 실제 대상의 포트가 열려있지 않다면, 통신에 실패하며 반대로 상태 검사 결과가 unhealthy 하여도 실재 대상 포트가 열려 있다면, 트래픽 분산이 발생하지 않습니다. 
- **상태 검사 프로토콜**: 타겟 그룹의 상태 검사 프로토콜을 선택합니다 (예: TCP, UDP) 기본적으로 상태 검사 프로토콜은 대상 그룹의 프로토콜과 동일합니다.
- **상태 검사 포트**: 타겟 그룹의 상태 검사 포트를 입렵합니다. 기본적으로 상태 검사 포트는 대상 그룹의 포트와 동일합니다. 
- **비정상 임계값**: 대상을 비정상 상태로 간주하기까지 필요한 연속적인 상태 검사 실패 횟수입니다. 기본적으로 2회이며, 기본 간격은 30초입니다. 

### 3. 타겟 설정
설정한 타겟 유형에 따라 타겟을 추가합니다. (필요시 나중에 상세 화면에서도 추가 가능) IP 주소와 포트 번호의 조합이 중복될 경우 추가가 제한됩니다. 
- 인스턴스 타겟의 경우 
  - **인스턴스**: VPC 내 인스턴스 목록에서 인스턴스를 선택합니다. 
  - **인터페이스**: 인스턴스의 인터페이스를 선택합니다. 
  - **포트 번호**: 타겟의 포트 번호를 입력합니다. 기본적으로 타겟 그룹의 포트 번호와 동일합니다. 
  - **가중치**: 타겟의 부하 분산 가중치를 입력합니다. 
- IP 주소 타겟의 경우  
  - **IP 주소**: 타겟의 IP 주소를 입력합니다. 
  - **포트 번호**: 타겟의 포트 번호를 입력합니다. 기본적으로 타겟 그룹의 포트 번호와 동일합니다.
  - **가중치**: 타겟의 부하 분산 가중치를 입력합니다. 

### 타겟 그룹 생성 — 필드 유효성 표
| 필드                     | 허용 값                      | 검증 규칙 | 비고 |
|------------------------|---------------------------|---|---|
| **이름**                 | 영문/숫자/`-`/`_`             | 최대 20자, 첫 글자 숫자 불가, 공백 불가 | **필수** |
| **VPC**                | 현재 프로젝트의 VPC 1개           | 존재하는 VPC만 선택 가능 | **필수** |
| **프로토콜**               | `TCP` \| `UDP` *(UI에 표시된 항목)* | 값 중 하나를 선택해야 함 | **필수** |
| **포트**                 | 1–65535(정수)               | 숫자만 입력 | **필수** |
| **대상 타입**              | `인스턴스` \| `IP 주소`         | 값 중 하나를 선택해야 함 | **필수** |
| **상태 검사 프로토콜**         | `TCP` \| `UDP` *(UI에 표시된 항목)* | 값 중 하나를 선택해야 함 | 선택 |
| **상태 검사 포트**               | 1–65535(정수)               | 숫자만 입력 | 선택 |
| **상태 검사 실패 임계치**       | 정수                   | 숫자만 입력 | 선택 |
| **설명**                 | 문자열                       | 최대 200자 | 선택 |

### 대상(타겟) 추가 — 필드 유효성 표
| 필드 | 허용 값              | 검증 규칙 | 비고 |
|---|-------------------|---|---|
| **대상 타입** | `인스턴스` \| `IP 주소` | 타겟 그룹의 대상 타입과 **일치**해야 함 | **필수** |
| **인스턴스 선택** *(대상 타입=인스턴스)* | 선택한 VPC 내 인스턴스    | 존재/상태 확인 불가 | **필수(조건부)** |
| **네트워크 인터페이스(IP)** *(인스턴스)* | 해당 인스턴스의 내부 IPv4  | 다중 NIC 중 1개 선택 | **필수(조건부)** |
| **IP 주소 입력** *(대상 타입=IP)* | IPv4              | 유효한 IPv4 | **필수(조건부)** |
| **포트(대상 수신 포트)** | 1–65535(정수)       | 숫자만 입력 | **필수** |
| **설명** | 문자열               | 최대 200자 | 선택 |

## 타겟 그룹 편집
타겟 그룹의 이름과 설명, 상태 검사 설정(프로토콜, 포트, 비정상 입계값)을 변경할 수 있습니다. 

| 컬럼             | 설명                                                                                         |
|----------------|--------------------------------------------------------------------------------------------|
| **이름**         | 타겟 그룹의 이름을 변경할 수 있습니다.                                                                     |
| **상태 검사 프로토콜** | 상태 검사의 프로토콜을 `TCP` 또는 `UDP`로 변경할 수 있습니다.                                                   |
| **상태 검사 포트**   | 	상태 검사의 포트를 변경할 수 있습니다.                                                                    |
| **비정상 임계값**    | 	상태 검사의 비정상 임계값을 변경할 수 있습니다.                                                               |
| **설명**         | 	타겟 그룹의 설명을 용도에 맞게 변경할 수 있습니다.                                                             |

## 타겟 편집
타겟 그룹의 타겟을 `추가`하거나 `편집`, `삭제`할 수 있습니다. `추가` 버튼을 통해 새로운 타겟을 추가하고, 기존 타겟을 선택해 `편집`할 수 있습니다. 편집 시 IP 주소, 포트 번호, 가중치를 변경할 수 있습니다. 추가와 편집 항목은 동일합니다. 

- 인스턴스 타겟의 경우

  | 컬럼             | 설명                                                                                         |
  |----------------|--------------------------------------------------------------------------------------------|
  | **인스턴스**| VPC 내 인스턴스 목록에서 인스턴스를 선택합니다.|
  | **인터페이스**| 인스턴스의 인터페이스를 선택합니다.|
  | **포트 번호**| 타겟의 포트 번호를 입력합니다. 기본적으로 타겟 그룹의 포트 번호와 동일합니다.|
  | **가중치**| 타겟의 부하 분산 가중치를 입력합니다.|

- IP 주소 타겟의 경우

  | 컬럼             | 설명                                                                                         |
  |----------------|--------------------------------------------------------------------------------------------|
  | **IP 주소**| 타겟의 IP 주소를 입력합니다.|
  | **포트 번호**| 타겟의 포트 번호를 입력합니다. 기본적으로 타겟 그룹의 포트 번호와 동일합니다.|
  | **가중치**| 타겟의 부하 분산 가중치를 입력합니다. |

> ⚠️ **편집 제한:** **시스템에서 자동 생성된 타겟 그룹**(예: Kubernetes에 의해 생성)인 경우 타겟 `편집`이 제한됩니다. 타겟 변경은 타겟 그룹의 상세 화면에서 수행해야 합니다. 

## 타겟 그룹 삭제
**삭제는 여러 개를 동시에 선택하여 실행**할 수 있습니다. 
삭제하고자 하는 타겟 그룹을 선택하고 **삭제** 버튼을 클릭하여 ** 타겟 그룹 삭제하시겠습니까?**라는 확인 창이 나타납니다. 확인을 눌러 삭제합니다.

> 💡 **주의사항:** 타겟 그룹이 로드밸런서에 연결되어 있지 않은 경우에만 삭제할 수 있습니다. 연결된 타겟 그룹을 선택하고 삭제하면 삭제가 수행되지 않으며 경고가 표시됩니다. <br> 타겟 그룹을 로드 밸런서에서 **분리(삭제)**하려면 로드 밸런서 상세 화면에서 리스너 삭제 작업(연결 해제)을 수행해야 합니다. 목록에서의 삭제는 로드 밸런서가 미사용하는 타겟 그룹을 제거하는 용도입니다.
